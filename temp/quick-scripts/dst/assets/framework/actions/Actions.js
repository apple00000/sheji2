
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/framework/actions/Actions.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '9b462XreAtDoJefQPMuD8lR', 'Actions');
// framework/actions/Actions.ts

// Learn TypeScript:
//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html
//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html
// Learn Attribute:
//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html
//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html
//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html
Object.defineProperty(exports, "__esModule", { value: true });
var Actions = /** @class */ (function () {
    function Actions() {
    }
    /** 向下移动 */
    Actions.downward = function (speed, height) {
        return cc.moveBy(height / speed, cc.v2(0, -height));
    };
    /** 向上移动 */
    Actions.upward = function (speed, height) {
        return cc.moveBy(height / speed, cc.v2(0, height));
    };
    /** 周期性动作 */
    Actions.cycleAction = function (action, startValue, endValue, deltaValue, speed, times, damping, cycleDelay) {
        if (damping === void 0) { damping = 0; }
        if (cycleDelay === void 0) { cycleDelay = 0; }
        var deltaValue_abs = Math.abs(deltaValue);
        var actions = [];
        actions.push(action(deltaValue_abs / speed, startValue + deltaValue));
        if (cycleDelay > 0) {
            actions.push(cc.delayTime(cycleDelay));
        }
        for (var i = 0; i < times; i++) {
            var newDeltaRotation = deltaValue_abs - (i * damping);
            var duation = newDeltaRotation * 2 / speed;
            var rotation = newDeltaRotation;
            if (deltaValue > 0) {
                if (i % 2 == 0) {
                    rotation = -rotation;
                }
            }
            else {
                if (i % 2 == 1) {
                    rotation = -rotation;
                }
            }
            actions.push(action(duation, startValue + rotation));
            if (cycleDelay > 0 && i % 2 == 1) {
                actions.push(cc.delayTime(cycleDelay));
            }
        }
        var lastValue = deltaValue_abs - (times - 1) * damping;
        if (deltaValue > 0) {
            if (times % 2 == 0) {
                lastValue = -lastValue;
            }
        }
        else {
            if (times % 2 == 1) {
                lastValue = -lastValue;
            }
        }
        actions.push(action(Math.abs(endValue - (startValue + lastValue)) / speed, endValue));
        return cc.sequence(actions);
    };
    /** 延迟执行 */
    Actions.delayTimeCall = function (delay, call) {
        return cc.sequence(cc.delayTime(delay), cc.callFunc(call));
    };
    /** 循环任务 */
    Actions.scheduleCall = function (interval, call) {
        if (typeof call == "function") {
            return cc.repeatForever(cc.sequence(cc.delayTime(interval), cc.callFunc(call)));
        }
        else {
            return cc.repeatForever(cc.sequence(cc.delayTime(interval), call));
        }
    };
    /** 每一帧执行 */
    Actions.update = function (call) {
        return this.scheduleCall(0, function () {
            call(cc.director.getDeltaTime());
        });
    };
    /** 高亮显示动作（先放大再缩小,适合更换字体时调用） */
    Actions.highlightAction = function (maxScaleCall) {
        var call = function () {
            if (maxScaleCall)
                maxScaleCall();
        };
        var seq = cc.sequence([
            cc.scaleTo(0.1, 1.4),
            cc.callFunc(call),
            cc.scaleTo(0.07, 0.8),
            cc.scaleTo(0.07, 1.1),
            cc.scaleTo(0.07, 0.9),
            cc.scaleTo(0.07, 1),
        ]);
        return seq;
    };
    /** 飘动显示效果(适合显示label提示，类似toast) */
    Actions.flutterAction = function () {
        var moveSeq = cc.sequence([
            cc.moveBy(0.6, cc.v2(0, 0)),
            cc.moveBy(1, cc.v2(0, 84))
        ]);
        var scaleSeq = cc.sequence([
            cc.scaleTo(0.1, 1.2),
            cc.scaleTo(0.1, 0.8),
            cc.scaleTo(0.1, 1),
        ]);
        var alphaSeq = cc.sequence([
            cc.fadeTo(0.8, 255),
            cc.fadeTo(0.8, 0),
        ]);
        var spawn = cc.spawn(moveSeq, scaleSeq, alphaSeq);
        return spawn;
    };
    /**
     * 圆运动
     * @param {Number} duration
     * @param {cc.Node|cc.p} dot 圆心点坐标或者node
     * @param {Number}   半径 如果为负数, 反时钟方向
     * @param {Number}  旋转角度
     * @returns {cc.CardinalSplineTo}
     */
    Actions.circleBy = function (duration, dot, r, angle) {
        var dp = angle || 20, dpr = 360 / dp, ary = [];
        r = r || 20;
        if (r < 0)
            dpr = -dpr;
        r = Math.abs(r);
        var rad = Math.PI / 180;
        for (var i = 0; i < dp; i++) {
            ary.push(cc.v2(Math.sin(dpr * i * rad) * r + dot.x, Math.cos(dpr * i * rad) * r + dot.y));
        }
        ary.push(ary);
        return cc.cardinalSplineTo(duration, ary, 0);
    };
    ;
    /**
     * 伪3D的翻转动作
     * @param {number} duration
     * @param {number} skewY
     * @return {cc.FiniteTimeAction}
     */
    Actions.flipXAction = function (duration, skewY) {
        if (duration === void 0) { duration = 0.5; }
        if (skewY === void 0) { skewY = 10; }
        var speed = duration / 38;
        var scale = cc.sequence(cc.scaleTo(speed * 9, 0.1, 1), cc.scaleTo(speed * 2, -0.1, 1), cc.scaleTo(speed * 8, -0.9, 1), cc.scaleTo(speed * 8, -0.1, 1), cc.scaleTo(speed * 2, 0.1, 1), cc.scaleTo(speed * 9, 1, 1));
        var skew = cc.sequence(cc.skewTo(speed * 9, 0, -skewY), cc.skewTo(speed * 2, 0, -skewY), cc.skewTo(speed * 8, 0, 0), cc.skewTo(speed * 8, 0, skewY), cc.skewTo(speed * 2, 0, skewY), cc.skewTo(speed * 9, 0, 0));
        return cc.spawn(scale, skew);
    };
    /**
     * 炸出金币的效果
     * @param {cc.Node} prefabNode
     * @param {cc.Node} parent
     * @param {cc.Vec2} startPos
     * @param {cc.Vec2} endPos
     * @param {number} radius
     * @param {number} num
     * @param {number} moveSpeed
     */
    Actions.boom = function (createNode, startPos, endPos, radius, num, moveSpeed, callback) {
        if (moveSpeed === void 0) { moveSpeed = 2000; }
        var list = [];
        var promise = [];
        var _loop_1 = function (i) {
            promise.push(new Promise(function (resolve, reject) {
                var node = createNode();
                node.position = startPos;
                list.push(node);
                /** 炸开动作 */
                var angle = i * 360 / num - 45;
                // node.rotation = 45+angle;
                /** 计算向量 */
                var normal = cc.v2(1, 1).rotateSelf(-angle * Math.PI / 180);
                var position = normal.mul(radius);
                var boomSpeed = 500;
                node.runAction(cc.sequence(cc.moveBy(radius / boomSpeed, position).easing(cc.easeExponentialOut()), cc.callFunc(function () {
                    /** 移动 */
                    resolve();
                })));
                // node.runAction(cc.repeatForever(Actions.flipXAction(i%2==0?1:0.9)));
                // node.getComponent(cc.Animation).play(null, i%2==0?0:0.2);
            }));
        };
        for (var i = 0; i < num; i++) {
            _loop_1(i);
        }
        Promise.all(promise).then(function (res) {
            /** 分成两部分 */
            var halfNum = Math.floor(num / 2);
            var _loop_2 = function (i) {
                var node = list[i];
                var sub = endPos.sub(node.position);
                var moveTime = sub.mag() / moveSpeed;
                var center = node.position.add(sub.mul(0.5));
                var p = sub.normalize().rotate(-90 * Math.PI / 180);
                var toAction = cc.bezierTo(moveTime, [
                    center.add(p.mul(200)),
                    endPos,
                    endPos
                ]);
                node.runAction(cc.sequence(cc.delayTime(i * 0.08), cc.spawn(toAction.easing(cc.easeSineOut()), cc.scaleTo(moveTime, 0.5), cc.fadeTo(moveTime, 80)), cc.callFunc(function () {
                    node.active = false;
                    if (callback) {
                        callback();
                    }
                })));
            };
            for (var i = 0; i < halfNum; i++) {
                _loop_2(i);
            }
            var _loop_3 = function (i) {
                var node = list[list.length - 1 - i];
                var sub = endPos.sub(node.position);
                var moveTime = sub.mag() / moveSpeed;
                var center = node.position.add(sub.mul(0.5));
                var p = sub.normalize().rotate(-90 * Math.PI / 180);
                var toAction = cc.bezierTo(moveTime, [
                    center.add(p.mul(-200)),
                    endPos,
                    endPos
                ]);
                node.runAction(cc.sequence(cc.delayTime(i * 0.08), cc.spawn(toAction.easing(cc.easeSineOut()), cc.scaleTo(moveTime, 0.5), cc.fadeTo(moveTime, 80)), cc.callFunc(function () {
                    node.active = false;
                    if (callback) {
                        callback();
                    }
                })));
            };
            for (var i = 0; i < list.length - halfNum; i++) {
                _loop_3(i);
            }
        });
    };
    return Actions;
}());
exports.default = Actions;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9mcmFtZXdvcmsvYWN0aW9ucy9BY3Rpb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBLG9CQUFvQjtBQUNwQixpRkFBaUY7QUFDakYseUZBQXlGO0FBQ3pGLG1CQUFtQjtBQUNuQiwyRkFBMkY7QUFDM0YsbUdBQW1HO0FBQ25HLDhCQUE4QjtBQUM5QiwyRkFBMkY7QUFDM0YsbUdBQW1HOztBQUduRztJQUFBO0lBcVBBLENBQUM7SUFuUEcsV0FBVztJQUNKLGdCQUFRLEdBQWYsVUFBZ0IsS0FBYSxFQUFFLE1BQWM7UUFDekMsT0FBTyxFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxLQUFLLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFFRCxXQUFXO0lBQ0osY0FBTSxHQUFiLFVBQWMsS0FBYSxFQUFFLE1BQWM7UUFDdkMsT0FBTyxFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxLQUFLLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBRUQsWUFBWTtJQUNMLG1CQUFXLEdBQWxCLFVBQW1CLE1BQWdCLEVBQUUsVUFBa0IsRUFBRSxRQUFnQixFQUFFLFVBQWtCLEVBQUUsS0FBYSxFQUFFLEtBQWEsRUFBRSxPQUFtQixFQUFFLFVBQXNCO1FBQTNDLHdCQUFBLEVBQUEsV0FBbUI7UUFBRSwyQkFBQSxFQUFBLGNBQXNCO1FBQ3BLLElBQUksY0FBYyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDMUMsSUFBSSxPQUFPLEdBQTBCLEVBQUUsQ0FBQztRQUN4QyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxjQUFjLEdBQUcsS0FBSyxFQUFFLFVBQVUsR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBQ3RF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QUFDLENBQUM7O1lBakJULEtBQUssSUFBSSxDQUFDLEdBQUMsQ0FBQyxFQUFFLENBQUMsR0FBQyxJQUFJLENBQUMsTUFBTSxHQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUU7d0JBQS9CLENBQUM7YUFrQlQ7UUFFTCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFTCxjQUFDO0FBQUQsQ0FyUEEsQUFxUEMsSUFBQSIsImZpbGUiOiIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExlYXJuIFR5cGVTY3JpcHQ6XHJcbi8vICAtIFtDaGluZXNlXSBodHRwOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvemgvc2NyaXB0aW5nL3R5cGVzY3JpcHQuaHRtbFxyXG4vLyAgLSBbRW5nbGlzaF0gaHR0cDovL3d3dy5jb2NvczJkLXgub3JnL2RvY3MvY3JlYXRvci9tYW51YWwvZW4vc2NyaXB0aW5nL3R5cGVzY3JpcHQuaHRtbFxyXG4vLyBMZWFybiBBdHRyaWJ1dGU6XHJcbi8vICAtIFtDaGluZXNlXSBodHRwOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvemgvc2NyaXB0aW5nL3JlZmVyZW5jZS9hdHRyaWJ1dGVzLmh0bWxcclxuLy8gIC0gW0VuZ2xpc2hdIGh0dHA6Ly93d3cuY29jb3MyZC14Lm9yZy9kb2NzL2NyZWF0b3IvbWFudWFsL2VuL3NjcmlwdGluZy9yZWZlcmVuY2UvYXR0cmlidXRlcy5odG1sXHJcbi8vIExlYXJuIGxpZmUtY3ljbGUgY2FsbGJhY2tzOlxyXG4vLyAgLSBbQ2hpbmVzZV0gaHR0cDovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL3poL3NjcmlwdGluZy9saWZlLWN5Y2xlLWNhbGxiYWNrcy5odG1sXHJcbi8vICAtIFtFbmdsaXNoXSBodHRwOi8vd3d3LmNvY29zMmQteC5vcmcvZG9jcy9jcmVhdG9yL21hbnVhbC9lbi9zY3JpcHRpbmcvbGlmZS1jeWNsZS1jYWxsYmFja3MuaHRtbFxyXG5cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFjdGlvbnMge1xyXG5cclxuICAgIC8qKiDlkJHkuIvnp7vliqggKi9cclxuICAgIHN0YXRpYyBkb3dud2FyZChzcGVlZDogTnVtYmVyLCBoZWlnaHQ6IE51bWJlcik6IGNjLkFjdGlvbkludGVydmFsIHtcclxuICAgICAgICByZXR1cm4gY2MubW92ZUJ5KGhlaWdodCAvIHNwZWVkLCBjYy52MigwLCAtaGVpZ2h0KSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOWQkeS4iuenu+WKqCAqL1xyXG4gICAgc3RhdGljIHVwd2FyZChzcGVlZDogTnVtYmVyLCBoZWlnaHQ6IE51bWJlcik6IGNjLkFjdGlvbkludGVydmFsIHtcclxuICAgICAgICByZXR1cm4gY2MubW92ZUJ5KGhlaWdodCAvIHNwZWVkLCBjYy52MigwLCBoZWlnaHQpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5ZGo5pyf5oCn5Yqo5L2cICovXHJcbiAgICBzdGF0aWMgY3ljbGVBY3Rpb24oYWN0aW9uOiBGdW5jdGlvbiwgc3RhcnRWYWx1ZTogTnVtYmVyLCBlbmRWYWx1ZTogTnVtYmVyLCBkZWx0YVZhbHVlOiBOdW1iZXIsIHNwZWVkOiBOdW1iZXIsIHRpbWVzOiBOdW1iZXIsIGRhbXBpbmc6IE51bWJlciA9IDAsIGN5Y2xlRGVsYXk6IE51bWJlciA9IDApOiBjYy5BY3Rpb25JbnRlcnZhbCB7XHJcbiAgICAgICAgbGV0IGRlbHRhVmFsdWVfYWJzID0gTWF0aC5hYnMoZGVsdGFWYWx1ZSk7XHJcbiAgICAgICAgbGV0IGFjdGlvbnM6IFtjYy5GaW5pdGVUaW1lQWN0aW9uXSA9IFtdO1xyXG4gICAgICAgIGFjdGlvbnMucHVzaChhY3Rpb24oZGVsdGFWYWx1ZV9hYnMgLyBzcGVlZCwgc3RhcnRWYWx1ZSArIGRlbHRhVmFsdWUpKTtcclxuICAgICAgICBpZiAoY3ljbGVEZWxheSA+IDApIHtcclxuICAgICAgICAgICAgYWN0aW9ucy5wdXNoKGNjLmRlbGF5VGltZShjeWNsZURlbGF5KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGltZXM7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgbmV3RGVsdGFSb3RhdGlvbiA9IGRlbHRhVmFsdWVfYWJzIC0gKGkgKiBkYW1waW5nKTtcclxuICAgICAgICAgICAgbGV0IGR1YXRpb24gPSBuZXdEZWx0YVJvdGF0aW9uICogMiAvIHNwZWVkO1xyXG4gICAgICAgICAgICBsZXQgcm90YXRpb24gPSBuZXdEZWx0YVJvdGF0aW9uO1xyXG4gICAgICAgICAgICBpZiAoZGVsdGFWYWx1ZSA+IDApIHtcclxuICAgICAgICAgICAgICAgIGlmIChpICUgMiA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcm90YXRpb24gPSAtcm90YXRpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSAlIDIgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uID0gLXJvdGF0aW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBhY3Rpb25zLnB1c2goYWN0aW9uKGR1YXRpb24sIHN0YXJ0VmFsdWUgKyByb3RhdGlvbikpO1xyXG4gICAgICAgICAgICBpZiAoY3ljbGVEZWxheSA+IDAgJiYgaSAlIDIgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgYWN0aW9ucy5wdXNoKGNjLmRlbGF5VGltZShjeWNsZURlbGF5KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGxhc3RWYWx1ZSA9IGRlbHRhVmFsdWVfYWJzIC0gKHRpbWVzIC0gMSkgKiBkYW1waW5nO1xyXG4gICAgICAgIGlmIChkZWx0YVZhbHVlID4gMCkge1xyXG4gICAgICAgICAgICBpZiAodGltZXMgJSAyID09IDApIHtcclxuICAgICAgICAgICAgICAgIGxhc3RWYWx1ZSA9IC1sYXN0VmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGltZXMgJSAyID09IDEpIHtcclxuICAgICAgICAgICAgICAgIGxhc3RWYWx1ZSA9IC1sYXN0VmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgYWN0aW9ucy5wdXNoKGFjdGlvbihNYXRoLmFicyhlbmRWYWx1ZSAtIChzdGFydFZhbHVlICsgbGFzdFZhbHVlKSkgLyBzcGVlZCwgZW5kVmFsdWUpKTtcclxuICAgICAgICByZXR1cm4gY2Muc2VxdWVuY2UoYWN0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOW7tui/n+aJp+ihjCAqL1xyXG4gICAgc3RhdGljIGRlbGF5VGltZUNhbGwoZGVsYXk6IE51bWJlciwgY2FsbDogRnVuY3Rpb24pOiBjYy5BY3Rpb25JbnRlcnZhbCB7XHJcbiAgICAgICAgcmV0dXJuIGNjLnNlcXVlbmNlKGNjLmRlbGF5VGltZShkZWxheSksIGNjLmNhbGxGdW5jKGNhbGwpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5b6q546v5Lu75YqhICovXHJcbiAgICBzdGF0aWMgc2NoZWR1bGVDYWxsKGludGVydmFsOiBOdW1iZXIsIGNhbGw6IEZ1bmN0aW9ufGNjLkZpbml0ZVRpbWVBY3Rpb24pOiBjYy5BY3Rpb25JbnRlcnZhbCB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBjYWxsID09IFwiZnVuY3Rpb25cIil7XHJcbiAgICAgICAgICAgIHJldHVybiBjYy5yZXBlYXRGb3JldmVyKGNjLnNlcXVlbmNlKGNjLmRlbGF5VGltZShpbnRlcnZhbCksIGNjLmNhbGxGdW5jKGNhbGwpKSk7XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gY2MucmVwZWF0Rm9yZXZlcihjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoaW50ZXJ2YWwpLCBjYWxsKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmr4/kuIDluKfmiafooYwgKi9cclxuICAgIHN0YXRpYyB1cGRhdGUoY2FsbDooZHQ6bnVtYmVyKT0+dm9pZCk6Y2MuQWN0aW9uSW50ZXJ2YWx7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NoZWR1bGVDYWxsKDAsICgpPT57XHJcbiAgICAgICAgICAgIGNhbGwoY2MuZGlyZWN0b3IuZ2V0RGVsdGFUaW1lKCkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKiog6auY5Lqu5pi+56S65Yqo5L2c77yI5YWI5pS+5aSn5YaN57yp5bCPLOmAguWQiOabtOaNouWtl+S9k+aXtuiwg+eUqO+8iSAqL1xyXG4gICAgc3RhdGljIGhpZ2hsaWdodEFjdGlvbihtYXhTY2FsZUNhbGw/OiBGdW5jdGlvbik6IGNjLkFjdGlvbkludGVydmFsIHtcclxuICAgICAgICBsZXQgY2FsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKG1heFNjYWxlQ2FsbCkgbWF4U2NhbGVDYWxsKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBsZXQgc2VxID0gY2Muc2VxdWVuY2UoW1xyXG4gICAgICAgICAgICBjYy5zY2FsZVRvKDAuMSwgMS40KSxcclxuICAgICAgICAgICAgY2MuY2FsbEZ1bmMoY2FsbCksXHJcbiAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4wNywgMC44KSxcclxuICAgICAgICAgICAgY2Muc2NhbGVUbygwLjA3LCAxLjEpLFxyXG4gICAgICAgICAgICBjYy5zY2FsZVRvKDAuMDcsIDAuOSksXHJcbiAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4wNywgMSksXHJcbiAgICAgICAgXSk7XHJcbiAgICAgICAgcmV0dXJuIHNlcTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog6aOY5Yqo5pi+56S65pWI5p6cKOmAguWQiOaYvuekumxhYmVs5o+Q56S677yM57G75Ly8dG9hc3QpICovXHJcbiAgICBzdGF0aWMgZmx1dHRlckFjdGlvbigpOiBjYy5GaW5pdGVUaW1lQWN0aW9uIHtcclxuICAgICAgICBsZXQgbW92ZVNlcSA9IGNjLnNlcXVlbmNlKFtcclxuICAgICAgICAgICAgY2MubW92ZUJ5KDAuNiwgY2MudjIoMCwgMCkpLFxyXG4gICAgICAgICAgICBjYy5tb3ZlQnkoMSwgY2MudjIoMCwgODQpKVxyXG4gICAgICAgIF0pO1xyXG5cclxuICAgICAgICBsZXQgc2NhbGVTZXEgPSBjYy5zZXF1ZW5jZShbXHJcbiAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4xLCAxLjIpLFxyXG4gICAgICAgICAgICBjYy5zY2FsZVRvKDAuMSwgMC44KSxcclxuICAgICAgICAgICAgY2Muc2NhbGVUbygwLjEsIDEpLFxyXG4gICAgICAgIF0pO1xyXG5cclxuICAgICAgICBsZXQgYWxwaGFTZXEgPSBjYy5zZXF1ZW5jZShbXHJcbiAgICAgICAgICAgIGNjLmZhZGVUbygwLjgsIDI1NSksXHJcbiAgICAgICAgICAgIGNjLmZhZGVUbygwLjgsIDApLFxyXG4gICAgICAgIF0pO1xyXG5cclxuICAgICAgICBsZXQgc3Bhd24gPSBjYy5zcGF3bihtb3ZlU2VxLCBzY2FsZVNlcSwgYWxwaGFTZXEpO1xyXG4gICAgICAgIHJldHVybiBzcGF3bjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWchui/kOWKqFxyXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGR1cmF0aW9uXHJcbiAgICAgKiBAcGFyYW0ge2NjLk5vZGV8Y2MucH0gZG90IOWchuW/g+eCueWdkOagh+aIluiAhW5vZGVcclxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSAgIOWNiuW+hCDlpoLmnpzkuLrotJ/mlbAsIOWPjeaXtumSn+aWueWQkVxyXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9ICDml4vovazop5LluqZcclxuICAgICAqIEByZXR1cm5zIHtjYy5DYXJkaW5hbFNwbGluZVRvfVxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY2lyY2xlQnkoZHVyYXRpb24sIGRvdCwgciwgYW5nbGUpOmNjLkFjdGlvbkludGVydmFse1xyXG4gICAgICAgIHZhciBkcCA9IGFuZ2xlIHx8IDIwLCBkcHIgPSAzNjAgLyBkcCwgYXJ5ID0gW107XHJcbiAgICAgICAgciA9IHIgfHwgMjA7XHJcbiAgICAgICAgaWYociA8IDApIGRwciA9IC1kcHI7XHJcbiAgICAgICAgciA9IE1hdGguYWJzKHIpO1xyXG5cclxuICAgICAgICBsZXQgcmFkID0gTWF0aC5QSS8xODA7XHJcblxyXG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBkcDsgaSArKyl7XHJcbiAgICAgICAgICAgIGFyeS5wdXNoKGNjLnYyKE1hdGguc2luKGRwciAqIGkgKiByYWQpICogciArIGRvdC54LCBNYXRoLmNvcyhkcHIgKiBpICogcmFkKSAqIHIgKyBkb3QueSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhcnkucHVzaChhcnkpO1xyXG4gICAgICAgIHJldHVybiBjYy5jYXJkaW5hbFNwbGluZVRvKGR1cmF0aW9uLCBhcnksIDApO1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDkvKozROeahOe/u+i9rOWKqOS9nFxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGR1cmF0aW9uXHJcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gc2tld1lcclxuICAgICAqIEByZXR1cm4ge2NjLkZpbml0ZVRpbWVBY3Rpb259XHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBmbGlwWEFjdGlvbihkdXJhdGlvbjpudW1iZXIgPSAwLjUsIHNrZXdZOm51bWJlcj0xMCk6Y2MuRmluaXRlVGltZUFjdGlvbntcclxuICAgICAgICBsZXQgc3BlZWQgPSBkdXJhdGlvbi8zODtcclxuICAgICAgICBsZXQgc2NhbGUgPSBjYy5zZXF1ZW5jZShcclxuICAgICAgICAgICAgY2Muc2NhbGVUbyhzcGVlZCo5LCAwLjEsIDEpLFxyXG4gICAgICAgICAgICBjYy5zY2FsZVRvKHNwZWVkKjIsIC0wLjEsIDEpLFxyXG4gICAgICAgICAgICBjYy5zY2FsZVRvKHNwZWVkKjgsIC0wLjksIDEpLFxyXG4gICAgICAgICAgICBjYy5zY2FsZVRvKHNwZWVkKjgsIC0wLjEsIDEpLFxyXG4gICAgICAgICAgICBjYy5zY2FsZVRvKHNwZWVkKjIsIDAuMSwgMSksXHJcbiAgICAgICAgICAgIGNjLnNjYWxlVG8oc3BlZWQqOSwgMSwgMSlcclxuICAgICAgICApO1xyXG4gICAgICAgIGxldCBza2V3ID0gY2Muc2VxdWVuY2UoXHJcbiAgICAgICAgICAgIGNjLnNrZXdUbyhzcGVlZCo5LCAwLCAtc2tld1kpLFxyXG4gICAgICAgICAgICBjYy5za2V3VG8oc3BlZWQqMiwgMCwgLXNrZXdZKSxcclxuICAgICAgICAgICAgY2Muc2tld1RvKHNwZWVkKjgsIDAsIDApLFxyXG4gICAgICAgICAgICBjYy5za2V3VG8oc3BlZWQqOCwgMCwgc2tld1kpLFxyXG4gICAgICAgICAgICBjYy5za2V3VG8oc3BlZWQqMiwgMCwgc2tld1kpLFxyXG4gICAgICAgICAgICBjYy5za2V3VG8oc3BlZWQqOSwgMCwgMClcclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiBjYy5zcGF3bihzY2FsZSwgc2tldyk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICog54K45Ye66YeR5biB55qE5pWI5p6cXHJcbiAgICAgKiBAcGFyYW0ge2NjLk5vZGV9IHByZWZhYk5vZGVcclxuICAgICAqIEBwYXJhbSB7Y2MuTm9kZX0gcGFyZW50XHJcbiAgICAgKiBAcGFyYW0ge2NjLlZlYzJ9IHN0YXJ0UG9zXHJcbiAgICAgKiBAcGFyYW0ge2NjLlZlYzJ9IGVuZFBvc1xyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHJhZGl1c1xyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG51bVxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG1vdmVTcGVlZFxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgYm9vbShjcmVhdGVOb2RlOigpPT5jYy5Ob2RlLCBzdGFydFBvczpjYy5WZWMyLCBlbmRQb3M6Y2MuVmVjMiwgcmFkaXVzOm51bWJlciwgbnVtOm51bWJlciwgbW92ZVNwZWVkOm51bWJlciA9IDIwMDAsIGNhbGxiYWNrPzooKT0+dm9pZCl7XHJcbiAgICAgICAgbGV0IGxpc3Q6W2NjLk5vZGVdID0gW107XHJcbiAgICAgICAgbGV0IHByb21pc2UgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpPTA7IGk8bnVtOyBpKyspe1xyXG4gICAgICAgICAgICBwcm9taXNlLnB1c2gobmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IG5vZGUgPSBjcmVhdGVOb2RlKCk7XHJcbiAgICAgICAgICAgICAgICBub2RlLnBvc2l0aW9uID0gc3RhcnRQb3M7XHJcbiAgICAgICAgICAgICAgICBsaXN0LnB1c2gobm9kZSk7XHJcbiAgICAgICAgICAgICAgICAvKiog54K45byA5Yqo5L2cICovXHJcbiAgICAgICAgICAgICAgICBsZXQgYW5nbGUgPSBpKjM2MC9udW0tNDU7XHJcbiAgICAgICAgICAgICAgICAvLyBub2RlLnJvdGF0aW9uID0gNDUrYW5nbGU7XHJcbiAgICAgICAgICAgICAgICAvKiog6K6h566X5ZCR6YePICovXHJcbiAgICAgICAgICAgICAgICBsZXQgbm9ybWFsID0gY2MudjIoMSwgMSkucm90YXRlU2VsZigtYW5nbGUqTWF0aC5QSS8xODApO1xyXG4gICAgICAgICAgICAgICAgbGV0IHBvc2l0aW9uID0gbm9ybWFsLm11bChyYWRpdXMpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGJvb21TcGVlZCA9IDUwMDtcclxuICAgICAgICAgICAgICAgIG5vZGUucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLm1vdmVCeShyYWRpdXMvYm9vbVNwZWVkLCBwb3NpdGlvbikuZWFzaW5nKGNjLmVhc2VFeHBvbmVudGlhbE91dCgpKSwgY2MuY2FsbEZ1bmMoKCk9PntcclxuICAgICAgICAgICAgICAgICAgICAvKiog56e75YqoICovXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSkpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBub2RlLnJ1bkFjdGlvbihjYy5yZXBlYXRGb3JldmVyKEFjdGlvbnMuZmxpcFhBY3Rpb24oaSUyPT0wPzE6MC45KSkpO1xyXG4gICAgICAgICAgICAgICAgLy8gbm9kZS5nZXRDb21wb25lbnQoY2MuQW5pbWF0aW9uKS5wbGF5KG51bGwsIGklMj09MD8wOjAuMik7XHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZSkudGhlbihyZXM9PntcclxuICAgICAgICAgICAgLyoqIOWIhuaIkOS4pOmDqOWIhiAqL1xyXG4gICAgICAgICAgICBsZXQgaGFsZk51bSA9IE1hdGguZmxvb3IobnVtLzIpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpPTA7IGk8aGFsZk51bTsgaSsrKXtcclxuICAgICAgICAgICAgICAgIGxldCBub2RlID0gbGlzdFtpXTtcclxuICAgICAgICAgICAgICAgIGxldCBzdWIgPSBlbmRQb3Muc3ViKG5vZGUucG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgbGV0IG1vdmVUaW1lID0gc3ViLm1hZygpL21vdmVTcGVlZDtcclxuICAgICAgICAgICAgICAgIGxldCBjZW50ZXIgPSBub2RlLnBvc2l0aW9uLmFkZChzdWIubXVsKDAuNSkpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHAgPSBzdWIubm9ybWFsaXplKCkucm90YXRlKC05MCpNYXRoLlBJLzE4MCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgdG9BY3Rpb24gPSBjYy5iZXppZXJUbyhtb3ZlVGltZSwgW1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbnRlci5hZGQocC5tdWwoMjAwKSksXHJcbiAgICAgICAgICAgICAgICAgICAgZW5kUG9zLFxyXG4gICAgICAgICAgICAgICAgICAgIGVuZFBvc1xyXG4gICAgICAgICAgICAgICAgXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MuZGVsYXlUaW1lKGkqMC4wOCksIGNjLnNwYXduKHRvQWN0aW9uLmVhc2luZyhjYy5lYXNlU2luZU91dCgpKSwgY2Muc2NhbGVUbyhtb3ZlVGltZSwgMC41KSwgY2MuZmFkZVRvKG1vdmVUaW1lLCA4MCkpLCBjYy5jYWxsRnVuYygoKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KSkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCBpPTA7IGk8bGlzdC5sZW5ndGgtaGFsZk51bTsgaSsrKXtcclxuICAgICAgICAgICAgICAgIGxldCBub2RlID0gbGlzdFtsaXN0Lmxlbmd0aC0xLWldO1xyXG4gICAgICAgICAgICAgICAgbGV0IHN1YiA9IGVuZFBvcy5zdWIobm9kZS5wb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICBsZXQgbW92ZVRpbWUgPSBzdWIubWFnKCkvbW92ZVNwZWVkO1xyXG4gICAgICAgICAgICAgICAgbGV0IGNlbnRlciA9IG5vZGUucG9zaXRpb24uYWRkKHN1Yi5tdWwoMC41KSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgcCA9IHN1Yi5ub3JtYWxpemUoKS5yb3RhdGUoLTkwKk1hdGguUEkvMTgwKTtcclxuICAgICAgICAgICAgICAgIGxldCB0b0FjdGlvbiA9IGNjLmJlemllclRvKG1vdmVUaW1lLCBbXHJcbiAgICAgICAgICAgICAgICAgICAgY2VudGVyLmFkZChwLm11bCgtMjAwKSksXHJcbiAgICAgICAgICAgICAgICAgICAgZW5kUG9zLFxyXG4gICAgICAgICAgICAgICAgICAgIGVuZFBvc1xyXG4gICAgICAgICAgICAgICAgXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MuZGVsYXlUaW1lKGkqMC4wOCksIGNjLnNwYXduKHRvQWN0aW9uLmVhc2luZyhjYy5lYXNlU2luZU91dCgpKSwgY2Muc2NhbGVUbyhtb3ZlVGltZSwgMC41KSwgY2MuZmFkZVRvKG1vdmVUaW1lLCA4MCkpLCBjYy5jYWxsRnVuYygoKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KSkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuXHJcbiJdfQ==