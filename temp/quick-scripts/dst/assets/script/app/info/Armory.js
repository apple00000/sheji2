
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/script/app/info/Armory.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'd4529RQIIBPsYekmld/nMb5', 'Armory');
// script/app/info/Armory.ts

Object.defineProperty(exports, "__esModule", { value: true });
var World_1 = require("./World");
var ExcelConfig_1 = require("../../../framework/config/ExcelConfig");
var ExcelTableNames_1 = require("../config/ExcelTableNames");
var EMITTER_POWER_LEVEL = "powerLv";
var EMITTER_FIRE_POWER_LEVEL = "firePowerLv";
// const POWER_MULS = [1,2,2,4,2,4,6,6,6,6,6];
var PAYLOAD_MULS = [1, 1, 10, 2, 5, 10, 1, 1, 1, 1, 1];
/** 试用加50级 */
var TRIAL_ADD = 50;
/** 武器库 */
var Armory = /** @class */ (function () {
    function Armory(map) {
        this._map = null;
        this._weaponUpCfg = null;
        this._bulletUpCfg = null;
        this._map = map;
        this._weaponUpCfg = ExcelConfig_1.ExcelConfig.getExcelTable(ExcelTableNames_1.ExcelTableNames.WeaponUp);
        this._bulletUpCfg = ExcelConfig_1.ExcelConfig.getExcelTable(ExcelTableNames_1.ExcelTableNames.BulletUp);
    }
    /** 伤害加成 */
    Armory.prototype.hurtMulOf = function (emitter) {
        var baseMul = this._weaponUpCfg[World_1.World.Storage.ADLv - 1]['fight'];
        if (emitter == 1) {
            return baseMul;
        }
        var lv = this.levelOfEmitterPower(emitter);
        if (emitter == World_1.World.Storage.unlockGun) {
            lv += TRIAL_ADD;
            if (lv > this._weaponUpCfg.length) {
                lv = this._weaponUpCfg.length;
            }
        }
        return this._weaponUpCfg[lv - 1]['hurt_add'] * baseMul;
    };
    /** 弹容量累加 */
    Armory.prototype.payloadAddOf = function (emitter) {
        if (emitter == 1)
            return 0;
        var lv = this.levelOfEmitterFirePower(emitter);
        if (emitter == World_1.World.Storage.unlockGun) {
            lv += TRIAL_ADD;
            if (lv > this._weaponUpCfg.length) {
                lv = this._weaponUpCfg.length;
            }
        }
        return this._bulletUpCfg[lv - 1]["gun_" + ("000" + emitter).substr(-3)];
    };
    /** 发射频率加成 */
    Armory.prototype.freMulOf = function (emitter) {
        var index = 0;
        if (emitter == 1) {
            index = World_1.World.Storage.ADLv - 1;
        }
        else {
            var lv = this.levelOfEmitterFirePower(emitter);
            if (emitter == World_1.World.Storage.unlockGun) {
                lv += TRIAL_ADD;
                if (lv > this._weaponUpCfg.length) {
                    lv = this._weaponUpCfg.length;
                }
            }
            index = lv - 1;
        }
        return this._weaponUpCfg[index]['fre'];
    };
    /** 射程加成 */
    Armory.prototype.rangeMulOf = function (emitter) {
        if (emitter == 4 || emitter == 5) {
            var lv = this.levelOfEmitterPower(emitter);
            if (emitter == World_1.World.Storage.unlockGun) {
                lv += TRIAL_ADD;
                if (lv > this._weaponUpCfg.length) {
                    lv = this._weaponUpCfg.length;
                }
            }
            return this._weaponUpCfg[lv - 1]['range_add'];
        }
        else {
            return 1;
        }
    };
    /** 放大加成 */
    Armory.prototype.magnifyMul = function (emitter) {
        if (emitter == 2 || emitter == 9 || emitter == 10) {
            var lv = this.levelOfEmitterPower(emitter);
            if (emitter == World_1.World.Storage.unlockGun) {
                lv += TRIAL_ADD;
                if (lv > this._weaponUpCfg.length) {
                    lv = this._weaponUpCfg.length;
                }
            }
            return this._weaponUpCfg[lv - 1]['amp_add'];
        }
        else {
            return 1;
        }
    };
    /** 获取武器的威力加成 */
    Armory.prototype.levelOfEmitterPower = function (emitter) {
        var data = this._map[emitter];
        if (data) {
            return data[EMITTER_POWER_LEVEL];
        }
        else {
            return 1;
        }
    };
    /** 获取武器的火力加成 */
    Armory.prototype.levelOfEmitterFirePower = function (emitter) {
        var data = this._map[emitter];
        if (data) {
            return data[EMITTER_FIRE_POWER_LEVEL];
        }
        else {
            return 1;
        }
    };
    Armory.prototype.addLevelOfEmitterPower = function (emitter, add) {
        var data = this._map[emitter];
        if (!data) {
            data = {};
            data[EMITTER_POWER_LEVEL] = 1;
            data[EMITTER_FIRE_POWER_LEVEL] = 1;
            this._map[emitter] = data;
        }
        data[EMITTER_POWER_LEVEL] = data[EMITTER_POWER_LEVEL] + add;
        World_1.World.Storage.armory = this.toJson();
    };
    Armory.prototype.addLevelOfEmitterFirePower = function (emitter, add) {
        var data = this._map[emitter];
        if (!data) {
            data = {};
            data[EMITTER_POWER_LEVEL] = 1;
            data[EMITTER_FIRE_POWER_LEVEL] = 1;
            this._map[emitter] = data;
        }
        data[EMITTER_FIRE_POWER_LEVEL] = data[EMITTER_FIRE_POWER_LEVEL] + add;
        World_1.World.Storage.armory = this.toJson();
    };
    Armory.prototype.toJson = function () {
        return JSON.stringify(this._map);
    };
    return Armory;
}());
exports.default = Armory;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHQvYXBwL2luZm8vQXJtb3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQSxpQ0FBOEI7QUFDOUIscUVBQWtFO0FBQ2xFLDZEQUEwRDtBQUUxRCxJQUFNLG1CQUFtQixHQUFHLFNBQVMsQ0FBQztBQUN0QyxJQUFNLHdCQUF3QixHQUFHLGFBQWEsQ0FBQztBQUUvQyw4Q0FBOEM7QUFDOUMsSUFBTSxZQUFZLEdBQUcsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUM7QUFFL0MsYUFBYTtBQUNiLElBQU0sU0FBUyxHQUFHLEVBQUUsQ0FBQztBQUVyQixVQUFVO0FBQ1Y7SUFFSSxnQkFBWSxHQUFHO1FBTVAsU0FBSSxHQUFvQixJQUFJLENBQUM7UUFDN0IsaUJBQVksR0FBTyxJQUFJLENBQUM7UUFDeEIsaUJBQVksR0FBTyxJQUFJLENBQUM7UUFQNUIsSUFBSSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7UUFDaEIsSUFBSSxDQUFDLFlBQVksR0FBRyx5QkFBVyxDQUFDLGFBQWEsQ0FBQyxpQ0FBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3hFLElBQUksQ0FBQyxZQUFZLEdBQUcseUJBQVcsQ0FBQyxhQUFhLENBQUMsaUNBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUM1RSxDQUFDO0lBT0QsV0FBVztJQUNYLDBCQUFTLEdBQVQsVUFBVSxPQUFjO1FBQ3BCLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsYUFBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDL0QsSUFBSSxPQUFPLElBQUksQ0FBQyxFQUFDO1lBQ2IsT0FBTyxPQUFPLENBQUM7U0FDbEI7UUFD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OUlBLEFBOElDLElBQUEiLCJmaWxlIjoiIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IHtXb3JsZH0gZnJvbSBcIi4vV29ybGRcIjtcclxuaW1wb3J0IHtFeGNlbENvbmZpZ30gZnJvbSBcIi4uLy4uLy4uL2ZyYW1ld29yay9jb25maWcvRXhjZWxDb25maWdcIjtcclxuaW1wb3J0IHtFeGNlbFRhYmxlTmFtZXN9IGZyb20gXCIuLi9jb25maWcvRXhjZWxUYWJsZU5hbWVzXCI7XHJcblxyXG5jb25zdCBFTUlUVEVSX1BPV0VSX0xFVkVMID0gXCJwb3dlckx2XCI7XHJcbmNvbnN0IEVNSVRURVJfRklSRV9QT1dFUl9MRVZFTCA9IFwiZmlyZVBvd2VyTHZcIjtcclxuXHJcbi8vIGNvbnN0IFBPV0VSX01VTFMgPSBbMSwyLDIsNCwyLDQsNiw2LDYsNiw2XTtcclxuY29uc3QgUEFZTE9BRF9NVUxTID0gWzEsMSwxMCwyLDUsMTAsMSwxLDEsMSwxXTtcclxuXHJcbi8qKiDor5XnlKjliqA1MOe6pyAqL1xyXG5jb25zdCBUUklBTF9BREQgPSA1MDtcclxuXHJcbi8qKiDmrablmajlupMgKi9cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXJtb3J5IHtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihtYXApe1xyXG4gICAgICAgIHRoaXMuX21hcCA9IG1hcDtcclxuICAgICAgICB0aGlzLl93ZWFwb25VcENmZyA9IEV4Y2VsQ29uZmlnLmdldEV4Y2VsVGFibGUoRXhjZWxUYWJsZU5hbWVzLldlYXBvblVwKTtcclxuICAgICAgICB0aGlzLl9idWxsZXRVcENmZyA9IEV4Y2VsQ29uZmlnLmdldEV4Y2VsVGFibGUoRXhjZWxUYWJsZU5hbWVzLkJ1bGxldFVwKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9tYXA6W251bWJlciwgbnVtYmVyXSA9IG51bGw7XHJcbiAgICBwcml2YXRlIF93ZWFwb25VcENmZzphbnkgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBfYnVsbGV0VXBDZmc6YW55ID0gbnVsbDtcclxuXHJcblxyXG4gICAgLyoqIOS8pOWus+WKoOaIkCAqL1xyXG4gICAgaHVydE11bE9mKGVtaXR0ZXI6bnVtYmVyKXtcclxuICAgICAgICBsZXQgYmFzZU11bCA9IHRoaXMuX3dlYXBvblVwQ2ZnW1dvcmxkLlN0b3JhZ2UuQURMdi0xXVsnZmlnaHQnXTtcclxuICAgICAgICBpZiAoZW1pdHRlciA9PSAxKXtcclxuICAgICAgICAgICAgcmV0dXJuIGJhc2VNdWw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBsdiA9IHRoaXMubGV2ZWxPZkVtaXR0ZXJQb3dlcihlbWl0dGVyKTtcclxuICAgICAgICBpZiAoZW1pdHRlciA9PSBXb3JsZC5TdG9yYWdlLnVubG9ja0d1bil7XHJcbiAgICAgICAgICAgIGx2ICs9IFRSSUFMX0FERDtcclxuICAgICAgICAgICAgaWYgKGx2ID4gdGhpcy5fd2VhcG9uVXBDZmcubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgIGx2ID0gdGhpcy5fd2VhcG9uVXBDZmcubGVuZ3RoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLl93ZWFwb25VcENmZ1tsdi0xXVsnaHVydF9hZGQnXSAqIGJhc2VNdWw7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOW8ueWuuemHj+e0r+WKoCAqL1xyXG4gICAgcGF5bG9hZEFkZE9mKGVtaXR0ZXI6bnVtYmVyKXtcclxuICAgICAgICBpZiAoZW1pdHRlciA9PSAxKXJldHVybiAwO1xyXG4gICAgICAgIGxldCBsdiA9IHRoaXMubGV2ZWxPZkVtaXR0ZXJGaXJlUG93ZXIoZW1pdHRlcik7XHJcbiAgICAgICAgaWYgKGVtaXR0ZXIgPT0gV29ybGQuU3RvcmFnZS51bmxvY2tHdW4pe1xyXG4gICAgICAgICAgICBsdiArPSBUUklBTF9BREQ7XHJcbiAgICAgICAgICAgIGlmIChsdiA+IHRoaXMuX3dlYXBvblVwQ2ZnLmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICBsdiA9IHRoaXMuX3dlYXBvblVwQ2ZnLmxlbmd0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5fYnVsbGV0VXBDZmdbbHYtMV1bXCJndW5fXCIrKFwiMDAwXCIrZW1pdHRlcikuc3Vic3RyKC0zKV07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOWPkeWwhOmikeeOh+WKoOaIkCAqL1xyXG4gICAgZnJlTXVsT2YoZW1pdHRlcjpudW1iZXIpe1xyXG4gICAgICAgIGxldCBpbmRleCA9IDA7XHJcbiAgICAgICAgaWYgKGVtaXR0ZXIgPT0gMSl7XHJcbiAgICAgICAgICAgIGluZGV4ID0gV29ybGQuU3RvcmFnZS5BREx2LTE7XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICBsZXQgbHYgPSB0aGlzLmxldmVsT2ZFbWl0dGVyRmlyZVBvd2VyKGVtaXR0ZXIpO1xyXG4gICAgICAgICAgICBpZiAoZW1pdHRlciA9PSBXb3JsZC5TdG9yYWdlLnVubG9ja0d1bil7XHJcbiAgICAgICAgICAgICAgICBsdiArPSBUUklBTF9BREQ7XHJcbiAgICAgICAgICAgICAgICBpZiAobHYgPiB0aGlzLl93ZWFwb25VcENmZy5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgICAgIGx2ID0gdGhpcy5fd2VhcG9uVXBDZmcubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGluZGV4ID0gbHYgLSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5fd2VhcG9uVXBDZmdbaW5kZXhdWydmcmUnXTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5bCE56iL5Yqg5oiQICovXHJcbiAgICByYW5nZU11bE9mKGVtaXR0ZXI6bnVtYmVyKXtcclxuICAgICAgICBpZiAoZW1pdHRlciA9PSA0IHx8IGVtaXR0ZXIgPT0gNSl7XHJcbiAgICAgICAgICAgIGxldCBsdiA9IHRoaXMubGV2ZWxPZkVtaXR0ZXJQb3dlcihlbWl0dGVyKTtcclxuICAgICAgICAgICAgaWYgKGVtaXR0ZXIgPT0gV29ybGQuU3RvcmFnZS51bmxvY2tHdW4pe1xyXG4gICAgICAgICAgICAgICAgbHYgKz0gVFJJQUxfQUREO1xyXG4gICAgICAgICAgICAgICAgaWYgKGx2ID4gdGhpcy5fd2VhcG9uVXBDZmcubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgICAgICBsdiA9IHRoaXMuX3dlYXBvblVwQ2ZnLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fd2VhcG9uVXBDZmdbbHYgLSAxXVsncmFuZ2VfYWRkJ107XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOaUvuWkp+WKoOaIkCAqL1xyXG4gICAgbWFnbmlmeU11bChlbWl0dGVyOm51bWJlcil7XHJcbiAgICAgICAgaWYgKGVtaXR0ZXIgPT0gMiB8fCBlbWl0dGVyID09IDkgfHwgZW1pdHRlciA9PSAxMCl7XHJcbiAgICAgICAgICAgIGxldCBsdiA9IHRoaXMubGV2ZWxPZkVtaXR0ZXJQb3dlcihlbWl0dGVyKTtcclxuICAgICAgICAgICAgaWYgKGVtaXR0ZXIgPT0gV29ybGQuU3RvcmFnZS51bmxvY2tHdW4pe1xyXG4gICAgICAgICAgICAgICAgbHYgKz0gVFJJQUxfQUREO1xyXG4gICAgICAgICAgICAgICAgaWYgKGx2ID4gdGhpcy5fd2VhcG9uVXBDZmcubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgICAgICBsdiA9IHRoaXMuX3dlYXBvblVwQ2ZnLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fd2VhcG9uVXBDZmdbbHYgLSAxXVsnYW1wX2FkZCddO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqIOiOt+WPluatpuWZqOeahOWogeWKm+WKoOaIkCAqL1xyXG4gICAgbGV2ZWxPZkVtaXR0ZXJQb3dlcihlbWl0dGVyOm51bWJlcil7XHJcbiAgICAgICAgbGV0IGRhdGEgPSB0aGlzLl9tYXBbZW1pdHRlcl07XHJcbiAgICAgICAgaWYgKGRhdGEpe1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YVtFTUlUVEVSX1BPV0VSX0xFVkVMXTtcclxuICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBcclxuXHJcbiAgICAvKiog6I635Y+W5q2m5Zmo55qE54Gr5Yqb5Yqg5oiQICovXHJcbiAgICBsZXZlbE9mRW1pdHRlckZpcmVQb3dlcihlbWl0dGVyOm51bWJlcil7XHJcbiAgICAgICAgbGV0IGRhdGEgPSB0aGlzLl9tYXBbZW1pdHRlcl07XHJcbiAgICAgICAgaWYgKGRhdGEpe1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YVtFTUlUVEVSX0ZJUkVfUE9XRVJfTEVWRUxdO1xyXG4gICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFkZExldmVsT2ZFbWl0dGVyUG93ZXIoZW1pdHRlcjpudW1iZXIsIGFkZDpudW1iZXIpe1xyXG4gICAgICAgIGxldCBkYXRhID0gdGhpcy5fbWFwW2VtaXR0ZXJdO1xyXG4gICAgICAgIGlmICghZGF0YSl7XHJcbiAgICAgICAgICAgIGRhdGEgPSB7fTtcclxuICAgICAgICAgICAgZGF0YVtFTUlUVEVSX1BPV0VSX0xFVkVMXSA9IDE7XHJcbiAgICAgICAgICAgIGRhdGFbRU1JVFRFUl9GSVJFX1BPV0VSX0xFVkVMXSA9IDE7XHJcbiAgICAgICAgICAgIHRoaXMuX21hcFtlbWl0dGVyXSA9IGRhdGE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRhdGFbRU1JVFRFUl9QT1dFUl9MRVZFTF0gPSBkYXRhW0VNSVRURVJfUE9XRVJfTEVWRUxdK2FkZDtcclxuICAgICAgICBXb3JsZC5TdG9yYWdlLmFybW9yeSA9IHRoaXMudG9Kc29uKCk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkTGV2ZWxPZkVtaXR0ZXJGaXJlUG93ZXIoZW1pdHRlcjpudW1iZXIsIGFkZDpudW1iZXIpe1xyXG4gICAgICAgIGxldCBkYXRhID0gdGhpcy5fbWFwW2VtaXR0ZXJdO1xyXG4gICAgICAgIGlmICghZGF0YSl7XHJcbiAgICAgICAgICAgIGRhdGEgPSB7fTtcclxuICAgICAgICAgICAgZGF0YVtFTUlUVEVSX1BPV0VSX0xFVkVMXSA9IDE7XHJcbiAgICAgICAgICAgIGRhdGFbRU1JVFRFUl9GSVJFX1BPV0VSX0xFVkVMXSA9IDE7XHJcbiAgICAgICAgICAgIHRoaXMuX21hcFtlbWl0dGVyXSA9IGRhdGE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRhdGFbRU1JVFRFUl9GSVJFX1BPV0VSX0xFVkVMXSA9IGRhdGFbRU1JVFRFUl9GSVJFX1BPV0VSX0xFVkVMXSArIGFkZDtcclxuICAgICAgICBXb3JsZC5TdG9yYWdlLmFybW9yeSA9IHRoaXMudG9Kc29uKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdG9Kc29uKCl7XHJcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMuX21hcCk7XHJcbiAgICB9XHJcbn1cclxuIl19