{"version":3,"sources":["assets/script/app/entities/role/ImpenetrableDefence.ts"],"names":[],"mappings":";;;;;AACA,kDAA+C;AAEzC,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAAiD,uCAAY;IAA7D;QAAA,qEAkFC;QA/EG,SAAG,GAAe,IAAI,CAAC;QAGvB,gBAAU,GAAW,IAAI,CAAC;QAElB,kBAAY,GAAG,IAAI,CAAC;QAwBhC,aAAa;QACD,4BAAsB,GAAG,CAAC,CAAC;QAE3B,gBAAU,GAAG,CAAC,CAAC;;IA+C3B,CAAC;IAvEa,oCAAM,GAAhB;QAAA,iBAeC;QAdG,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,gBAAgB,EAAE;YACnD,KAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC;QAClD,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,GAAG,CAAC,mBAAmB,CAAC,UAAC,UAAU,EAAE,IAAI;YAC1C,IAAI,IAAI,GAAG,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;YACjE,IAAI,IAAI,IAAI,OAAO,EAAC;gBAChB,KAAI,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;gBACxC,KAAI,CAAC,YAAY,GAAG,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,aAAa,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC1E,KAAI,CAAC,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;gBAC9B,KAAI,CAAC,IAAI,CAAC,SAAS,CAAC,KAAI,CAAC,YAAY,CAAC,CAAC;aAC1C;iBAAK,IAAI,IAAI,IAAI,YAAY,EAAC;gBAC3B,KAAI,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;aAC3C;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAED,mCAAK,GAAL;QACI,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC;IAClD,CAAC;IAQD,sBAAI,sDAAqB;aAAzB,UAA0B,KAAa;YACnC,IAAI,CAAC,sBAAsB,GAAG,KAAK,CAAC;YACpC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAC;gBAClB,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;gBACxB,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;gBAC3B,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC;aAC5C;QACL,CAAC;;;OAAA;IAED,qCAAO,GAAP;QACI,IAAI,IAAI,CAAC,GAAG,CAAC,SAAS,IAAI,OAAO,EAAC;YAC9B,iCAAiC;YACjC,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,EAAE,YAAY,EAAE,KAAK,CAAC,CAAC;YAC9C,yBAAyB;SAC5B;IACL,CAAC;IAED,oCAAM,GAAN,UAAO,EAAS;QACZ,IAAI,qBAAS,CAAC,SAAS;YAAC,OAAO;QAC/B,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,GAAG,GAAG,EAAC;YAC7B,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC;SACpD;QACD,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,GAAG,GAAG,EAAC;YAC7B,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC;SACpD;QACD,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,GAAG,GAAG,EAAC;YAC7B,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC;SACpD;QACD,IAAI,IAAI,CAAC,GAAG,CAAC,SAAS,KAAK,OAAO,EAAC;YAC/B,IAAI,IAAI,CAAC,UAAU,GAAG,CAAC,EAAC;gBACpB,IAAI,CAAC,UAAU,IAAI,EAAE,CAAC;aACzB;iBAAK,IAAI,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,GAAG,CAAC,EAAC;gBACvC,IAAI,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,GAAG,IAAI,CAAC;gBAChD,IAAI,KAAK,GAAG,CAAC,EAAC;oBACV,KAAK,GAAG,CAAC,CAAC;iBACb;gBACD,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;aACrC;SACJ;QACD,IAAI,CAAC,sBAAsB,IAAI,EAAE,CAAC;QAClC,IAAI,IAAI,CAAC,sBAAsB,IAAI,CAAC,EAAC;YACjC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;SAC5B;IACL,CAAC;IA9ED;QADC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC;oDACC;IAGvB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;2DACQ;IANT,mBAAmB;QADvC,OAAO;OACa,mBAAmB,CAkFvC;IAAD,0BAAC;CAlFD,AAkFC,CAlFgD,EAAE,CAAC,SAAS,GAkF5D;kBAlFoB,mBAAmB","file":"","sourceRoot":"/","sourcesContent":["\r\nimport {GameProxy} from \"../../game/GameProxy\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class ImpenetrableDefence extends cc.Component {\r\n\r\n    @property(sp.Skeleton)\r\n    ske:sp.Skeleton = null;\r\n\r\n    @property(cc.Node)\r\n    followNode:cc.Node = null;\r\n\r\n    private rotateAction = null;\r\n\r\n\r\n    protected onLoad(): void {\r\n        this.followNode.on(cc.Node.EventType.POSITION_CHANGED, ()=>{\r\n            this.node.position = this.followNode.position;\r\n        });\r\n        this.ske.setCompleteListener((trackEntry, loop)=>{\r\n            let name = trackEntry.animation ? trackEntry.animation.name : '';\r\n            if (name == \"start\"){\r\n                this.ske.setAnimation(0, \"loops\", true);\r\n                this.rotateAction = cc.speed(cc.repeatForever(cc.rotateBy(0.45, 360)), 0);\r\n                this.rotateAction.setTag(140);\r\n                this.node.runAction(this.rotateAction);\r\n            }else if (name == \"transition\"){\r\n                this.ske.setAnimation(0, \"loops\", true);\r\n            }\r\n        });\r\n    }\r\n\r\n    start(){\r\n        this.node.position = this.followNode.position;\r\n    }\r\n\r\n//密不透风的防御(武术)\r\n    private _impenetrableDefenceCD = 0;\r\n\r\n    private _defenceCD = 0;\r\n\r\n\r\n    set impenetrableDefenceCD(value: number) {\r\n        this._impenetrableDefenceCD = value;\r\n        if (!this.node.active){\r\n            this.node.active = true;\r\n            this.node.stopAllActions();\r\n            this.ske.setAnimation(0, \"start\", false);\r\n        }\r\n    }\r\n\r\n    defence(){\r\n        if (this.ske.animation == \"loops\"){\r\n            // this.rotateAction.setSpeed(0);\r\n            this.ske.setAnimation(0, \"transition\", false);\r\n            // this._defenceCD = 0.5;\r\n        }\r\n    }\r\n\r\n    update(dt:number){\r\n        if (GameProxy.pauseGame)return;\r\n        if (this.node.color.getR() < 255){\r\n            this.node.color.setR(this.node.color.getR() + 1);\r\n        }\r\n        if (this.node.color.getG() < 255){\r\n            this.node.color.setG(this.node.color.getG() + 1);\r\n        }\r\n        if (this.node.color.getB() < 255){\r\n            this.node.color.setB(this.node.color.getB() + 1);\r\n        }\r\n        if (this.ske.animation === \"loops\"){\r\n            if (this._defenceCD > 0){\r\n                this._defenceCD -= dt;\r\n            }else if (this.rotateAction.getSpeed() < 1){\r\n                let speed = this.rotateAction.getSpeed() + 0.01;\r\n                if (speed > 1){\r\n                    speed = 1;\r\n                }\r\n                this.rotateAction.setSpeed(speed);\r\n            }\r\n        }\r\n        this._impenetrableDefenceCD -= dt;\r\n        if (this._impenetrableDefenceCD <= 0){\r\n            this.node.active = false;\r\n        }\r\n    }\r\n}\r\n"]}