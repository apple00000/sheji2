{"version":3,"sources":["assets/script/app/entities/bullet/BulletOfLighting.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nimport Bullet from \"./Bullet\";\r\nimport BulletStrikeLightning from \"../bulletStrike/BulletStrikeLightning\";\r\nimport Enemy from \"../enemy/Enemy\";\r\nimport {World} from \"../../info/World\";\r\nimport {ExcelConfig} from \"../../../../framework/config/ExcelConfig\";\r\nimport {ExcelTableNames} from \"../../config/ExcelTableNames\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class BulletOfLighting extends Bullet {\r\n\r\n    private _ske:sp.Skeleton = null;\r\n\r\n    private _lightEnemys:Array<Enemy> = [];\r\n\r\n\r\n    onDisable(): void {\r\n        super.onDisable();\r\n        this._lightEnemys.length = 0;\r\n    }\r\n\r\n    strike(other, self): void {\r\n        let gameBulletsController = window['GameBulletsController'];\r\n        this._lightEnemys.push(other.getComponent(Enemy));\r\n        let bulletStrike = gameBulletsController.getInactiveBulletStrike(10);\r\n        bulletStrike.node.active = true;\r\n        bulletStrike.node.position = cc.v2();\r\n        bulletStrike.node.rotation = this.node.rotation;\r\n        bulletStrike.node.setContentSize(other.node.getContentSize());\r\n        bulletStrike.node.removeFromParent(false);\r\n        bulletStrike.node.setParent(other.node);\r\n\r\n        let spriteNode = (<BulletStrikeLightning>bulletStrike).spriteNode;\r\n        bulletStrike.node.rotation = Math.random()*360;\r\n        bulletStrike.node.runAction(cc.sequence(\r\n            cc.repeat(\r\n                cc.sequence(\r\n                    cc.delayTime(0.05),\r\n                    cc.callFunc(()=>{\r\n                        spriteNode.active = !spriteNode.active;\r\n                        // bulletStrike.node.rotation = Math.random()*360;\r\n                    })\r\n                ), 6),\r\n            cc.callFunc(()=>{\r\n                bulletStrike.node.stopAllActions();\r\n                bulletStrike.node.active = false;\r\n                bulletStrike.node.removeFromParent(false);\r\n                bulletStrike.node.setParent(gameBulletsController.bulletLayer);\r\n            })));\r\n    }\r\n\r\n    init(id: number): void {\r\n        this.bulletId = id;\r\n        let cfg = ExcelConfig.getExcelTable(ExcelTableNames.Prop)[this.bulletId-1];\r\n        this.bThrought = cfg['pierce'] === 1;\r\n        this.repel = cfg['repel'];\r\n        this.stiff = cfg['stiff'];\r\n        let config = ExcelConfig.getExcelTable(ExcelTableNames.Weapon)[0];\r\n        this.hurt = Math.floor(config['hurt']*World.My.armory.hurtMulOf(1))*cfg['hurt'];\r\n    }\r\n\r\n\r\n    onLoad(): void {\r\n        super.onLoad();\r\n        this._ske = this.getComponent(sp.Skeleton);\r\n        this._ske.setCompleteListener((trackEntry, loopCount) => {\r\n            let name = trackEntry.animation ? trackEntry.animation.name : '';\r\n            /** 寻找新的怪物攻击 */\r\n            /** 找最近的怪生成闪电 */\r\n            if (this._lightEnemys.length > 0 && this._lightEnemys.length < 6){\r\n                let list = window['GameEnemysController'].allAliveAndInScreenEnemy().filter(value => !this._lightEnemys.includes(value));\r\n                if (list.length > 0){\r\n                    let minDistance = -1;\r\n                    let enemy = null;\r\n                    list.forEach(value => {\r\n                        let distance = this.node.position.sub(value.node.position).mag();\r\n                        if (minDistance < 0 || distance < minDistance){\r\n                            minDistance = distance;\r\n                            enemy = value;\r\n                        }\r\n                    });\r\n                    /** 生成闪电 */\r\n                    let bullet = <BulletOfLighting>window['GameBulletsController'].getInactivePropBullet(6);\r\n                    bullet.node.position = this._lightEnemys[this._lightEnemys.length-1].node.position;\r\n                    bullet._lightEnemys.push(...this._lightEnemys);\r\n                    bullet.joint(enemy.node.position);\r\n                }\r\n            }\r\n            this.node.active = false;\r\n        });\r\n    }\r\n\r\n    joint(pos:cc.Vec2){\r\n        let sub = pos.sub(this.node.position);\r\n        let distance = sub.mag();\r\n        this.node.rotation = 90 - cc.misc.radiansToDegrees(Math.atan2(sub.y, sub.x));\r\n        this.node.scaleY = distance/380;\r\n        this.node.active = true;\r\n        this._ske.setAnimation(0, \"animation\", false);\r\n    }\r\n}\r\n"]}