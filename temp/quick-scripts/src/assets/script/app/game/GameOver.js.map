{"version":3,"sources":["assets/script/app/game/GameOver.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nimport Facade from \"../../../framework/facade/Facade\";\r\nimport {ext} from \"../../../framework/extend/Extend\";\r\nimport {GameProxy} from \"./GameProxy\";\r\nimport {World} from \"../info/World\";\r\nimport GameOverLucky from \"./GameOverLucky\";\r\nimport Network from \"../network/Network\";\r\nimport {NetworkConfig} from \"../config/NetworkConfig\";\r\nimport {ExcelConfig} from \"../../../framework/config/ExcelConfig\";\r\nimport {ExcelTableNames} from \"../config/ExcelTableNames\";\r\n\r\n//curTime = 80  subTime = 0.6   addTime = 10  max = 100   7次，第8次出误点banner\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GameOver extends cc.Component {\r\n\r\n    @property(cc.Label)\r\n    titleLabel:cc.Label = null;\r\n\r\n    @property(cc.Node)\r\n    topNode:cc.Node = null;\r\n\r\n    @property(cc.Label)\r\n    goldLabel:cc.Label = null;\r\n\r\n    @property(cc.Label)\r\n    videoGoldLabel:cc.Label = null;\r\n\r\n    @property(cc.Label)\r\n    videoMulLabel:cc.Label = null;\r\n\r\n    @property(cc.ProgressBar)\r\n    luckyProgressBar:cc.ProgressBar = null;\r\n\r\n    @property(GameOverLucky)\r\n    gameOverLucky:GameOverLucky = null;\r\n\r\n    @property(cc.Node)\r\n    oneButtonNode:cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    tripleButtonNode:cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    luckyButtonNode:cc.Node = null;\r\n\r\n    @property(cc.Sprite)\r\n    luckyVideoSprite:cc.Sprite = null;\r\n\r\n    @property(cc.SpriteFrame)\r\n    inviteSpriteFrame:cc.SpriteFrame = null;\r\n\r\n    @property(cc.SpriteFrame)\r\n    videoSpriteFrame:cc.SpriteFrame = null;\r\n\r\n\r\n    private _takeGoldOne = 0;\r\n\r\n    private _videoMul = 3;\r\n\r\n    onLoad(){\r\n        this.oneButtonNode.on(cc.Node.EventType.POSITION_CHANGED, ()=>{\r\n           this.luckyButtonNode.parent.position = this.oneButtonNode.position.add(cc.v2(0, 120));\r\n        });\r\n\r\n        cc.game.on(\"video_5\",()=>{\r\n            this.onGameOverTakeDajiangDo()\r\n        },this);\r\n    }\r\n\r\n    onEnable () {\r\n        this._takeGoldOne = 0;\r\n        this._videoMul = 3;\r\n        this.gameOverLucky.node.active = false;\r\n        this.gameOverLucky.node.zIndex = 10;\r\n        console.log(\"GameOver===>GameProxy.pauseGame = true\");\r\n        GameProxy.pauseGame = true;\r\n        // this.oneBackgroundSprite.setMaterial(0, cc.Material.getBuiltinMaterial(\"2d-gray-sprite\"));\r\n        this.node.children.forEach((value, index) => {\r\n            value.scale = 0;\r\n            value.runAction(cc.sequence(cc.delayTime(1+0.08*index), cc.scaleTo(0.2, 1).easing(cc.easeElasticOut(0.45))));\r\n        });\r\n\r\n        World.Storage.unlockGun = -World.Storage.unlockGun;\r\n        this.topNode.removeFromParent(false);\r\n        this.node.addChild(this.topNode);\r\n        this.topNode.getChildByName('progress').runAction(cc.sequence(cc.delayTime(0.3), cc.moveBy(0.35, cc.v2(0, -125))));\r\n        this.topNode.getChildByName('level').runAction(cc.sequence(cc.delayTime(0.7), cc.spawn(cc.scaleTo(0.35, 2).easing(cc.easeElasticOut(0.6)), cc.moveBy(0.35, cc.v2(0, -95)).easing(cc.easeElasticOut(0.6)))));\r\n        if (GameProxy.killCount >= GameProxy.maxEnemyNum){\r\n            // World.Storage.passLuckyCount++;\r\n            GameProxy.goldCount += GameProxy.passGold();\r\n            World.Storage.gameLevel++;\r\n            /** 上传关卡 */\r\n            if (NetworkConfig.connectServer){\r\n                Network.uploadLv(World.Storage.gameLevel);\r\n            }\r\n            /** 计算解锁最新的一把枪 */\r\n            let weaponConfig = ExcelConfig.getExcelTable(ExcelTableNames.Weapon);\r\n            for (let item of weaponConfig){\r\n                if (item['unlock'] == World.Storage.gameLevel){\r\n                    World.Storage.unlockGun = item['id'];\r\n                    break;\r\n                }\r\n            }\r\n        }else {\r\n            this.titleLabel.string = \"战斗失败\";\r\n        }\r\n        this._takeGoldOne = GameProxy.goldCount;\r\n        this.goldLabel.string = ext.shortFormat(this._takeGoldOne);\r\n        this.topNode.getChildByName('progress').getChildByName('goldLabel').getComponent(cc.Label).string = this.goldLabel.string;\r\n        this.updateVideo();\r\n        // this.oneButtonNode.active = false;\r\n        // this.scheduleOnce(()=>this.oneButtonNode.active = true, 2);\r\n        this.scheduleOnce(()=>{\r\n            this.luckyButtonNode.parent.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(0.5, 0.95), cc.scaleTo(0.5, 1))));\r\n        }, 2);\r\n    }\r\n\r\n    updateVideo(){\r\n        this.videoMulLabel.string = `x${this._videoMul}`;\r\n        this.videoGoldLabel.string = ext.shortFormat(this._takeGoldOne * this._videoMul);\r\n        this.luckyProgressBar.progress = 1;\r\n        this.tripleButtonNode.active = false;\r\n        // this.luckyProgressBar.progress = World.Storage.passLuckyCount/5;\r\n        // this.tripleButtonNode.active = World.Storage.passLuckyCount < 5;\r\n        this.luckyButtonNode.active = !this.tripleButtonNode.active;\r\n        let spriteFrame = this.inviteSpriteFrame;\r\n        // if (WXADVideo.canPlay()){\r\n        //     spriteFrame = this.videoSpriteFrame;\r\n        // }\r\n        this.luckyVideoSprite.spriteFrame = spriteFrame;\r\n    }\r\n\r\n    onGameOverTake(event, data){\r\n        console.log(\"【video】5 幸运大奖 【Click】GameOver onGameOverTake \", data)\r\n\r\n        let num = parseInt(data);\r\n        if (num == 1){\r\n            if (this._takeGoldOne > 0){\r\n                World.Storage.goldCount += this._takeGoldOne;\r\n                Facade.executeCommand('ShowTipsCommand', `金币 +${ext.shortFormat(this._takeGoldOne)}`);\r\n            }\r\n\r\n            this.node.active = false;\r\n            Facade.executeCommand(\"LoadSceneCommand\", \"HomeScene\");\r\n        } else {\r\n            this.onGameOverTakeDajiang()\r\n        }\r\n    }\r\n\r\n    onGameOverTakeDajiang(){\r\n        World.Storage._videoSign=5\r\n        World.Storage.videoAd_show()\r\n    }\r\n\r\n    onGameOverTakeDajiangDo(){\r\n        if (this.luckyProgressBar.progress >= 1){\r\n            console.log(\"幸运大奖.\");\r\n            this.gameOverLucky.node.active = true;\r\n            let num = ext.randomElement([10,9,8,7,6,5,4]);\r\n            this.gameOverLucky.run(num, ()=>{\r\n                this._videoMul = num;\r\n                // World.Storage.passLuckyCount = 0;\r\n                this.node.active = false;\r\n                let goldCount = this._takeGoldOne*this._videoMul;\r\n                if (goldCount > 0){\r\n                    World.Storage.goldCount += goldCount;\r\n                    Facade.executeCommand('ShowTipsCommand', `金币 +${ext.shortFormat(goldCount)}`);\r\n                }\r\n                Facade.executeCommand(\"LoadSceneCommand\", \"HomeScene\");\r\n            });\r\n            return;\r\n        }\r\n        let goldCount = this._takeGoldOne*this._videoMul;\r\n        if (goldCount > 0){\r\n            World.Storage.goldCount += goldCount;\r\n            Facade.executeCommand('ShowTipsCommand', `金币 +${ext.shortFormat(goldCount)}`);\r\n        }\r\n\r\n        this.node.active = false;\r\n        Facade.executeCommand(\"LoadSceneCommand\", \"HomeScene\");\r\n    }\r\n}\r\n"]}