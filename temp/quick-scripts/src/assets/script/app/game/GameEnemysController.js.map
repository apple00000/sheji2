{"version":3,"sources":["assets/script/app/game/GameEnemysController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Enemy from \"../entities/enemy/Enemy\";\r\nimport SpacePartition from \"../../../framework/extend/SpacePartition\";\r\nimport {GameProxy} from \"./GameProxy\";\r\nimport PropBase from \"../entities/prop/PropBase\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\nlet MAX_LOGIC_COUNT = 10;\r\n\r\n@ccclass\r\nexport default class GameEnemysController extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    propLayer:cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    enemyLayer:cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    enemyBloodLayer:cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    bgNode:cc.Node = null;\r\n\r\n    private _enemyCount = 0;\r\n\r\n    private enemyLogicList:Array<Enemy> = [];\r\n\r\n\r\n    get enemyCount(): number {\r\n        return this._enemyCount;\r\n    }\r\n\r\n    set enemyCount(value: number) {\r\n        this._enemyCount = value;\r\n    }\r\n\r\n    private _enmeyMap = new Map<number, Array<Enemy>>();\r\n    private _enmeyBloodArray:Array<cc.Node> = [];\r\n\r\n    private _propMap = new Map<number, Array<PropBase>>();\r\n    private _gunsArr:Array<PropBase> = [];\r\n\r\n    gameProps:Array<PropBase> = [];\r\n\r\n    private genEnemy(id:number):Enemy{\r\n        let prefabPath = 'prefab/entities/enemy/enemy'+id;\r\n        let entityPrefab = cc.loader.getRes(prefabPath, cc.Prefab);\r\n        let node = cc.instantiate(entityPrefab);\r\n        node.active = false;\r\n        this.enemyLayer.addChild(node);\r\n        let enemy = <Enemy>node.getComponent(Enemy);\r\n        enemy.init(id);\r\n        let arr = this._enmeyMap.get(id);\r\n        if (typeof arr == \"undefined\"){\r\n            arr = [];\r\n            this._enmeyMap.set(id, arr);\r\n        }\r\n        arr.push(enemy);\r\n        return enemy;\r\n    }\r\n\r\n    private getInactiveEnemy(id:number):Enemy{\r\n        let result:Enemy = undefined;\r\n        let arr = this._enmeyMap.get(id);\r\n        if (typeof arr != 'undefined'){\r\n            result = arr.find(value => value.node.active == false);\r\n        }\r\n        if (typeof result == \"undefined\"){\r\n            result = this.genEnemy(id);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private genEnemyBloodNode():cc.Node{\r\n        let prefabPath = 'prefab/entities/blood/blood';\r\n        let entityPrefab = cc.loader.getRes(prefabPath, cc.Prefab);\r\n        let node = cc.instantiate(entityPrefab);\r\n        node.active = false;\r\n        this.enemyBloodLayer.addChild(node);\r\n        this._enmeyBloodArray.push(node);\r\n        return node;\r\n    }\r\n\r\n    private getInactiveEnemyBloodNode():cc.Node{\r\n        let result:cc.Node = this._enmeyBloodArray.find(value => value.active == false);\r\n        if (typeof result == \"undefined\"){\r\n            result = this.genEnemyBloodNode();\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private genProp(id:number):PropBase{\r\n        let prefabPath = 'prefab/entities/prop/prop'+id;\r\n        let entityPrefab = cc.loader.getRes(prefabPath, cc.Prefab);\r\n        let node = cc.instantiate(entityPrefab);\r\n        node.active = false;\r\n        this.propLayer.addChild(node);\r\n        let prop = <PropBase>node.getComponent(PropBase);\r\n        prop.init(id);\r\n        let arr = this._propMap.get(id);\r\n        if (typeof arr == \"undefined\"){\r\n            arr = [];\r\n            this._propMap.set(id, arr);\r\n        }\r\n        arr.push(prop);\r\n        return prop;\r\n    }\r\n\r\n    getInactiveProp(id:number):PropBase{\r\n        let result:PropBase = undefined;\r\n        let arr = this._propMap.get(id);\r\n        if (typeof arr != 'undefined'){\r\n            result = arr.find(value => value.node.active == false);\r\n        }\r\n        if (typeof result == \"undefined\"){\r\n            result = this.genProp(id);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    getInactiveGun():PropBase{\r\n        let result = this._gunsArr.find(value => value.node.active == false);\r\n        if (typeof result == \"undefined\"){\r\n            let prefabPath = 'prefab/entities/prop/guns';\r\n            let entityPrefab = cc.loader.getRes(prefabPath, cc.Prefab);\r\n            let node = cc.instantiate(entityPrefab);\r\n            this.propLayer.addChild(node);\r\n            node.active = false;\r\n            result = <PropBase>node.getComponent(PropBase);\r\n            this._gunsArr.push(result);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    onLoad(){\r\n        this.node.on(GameProxy.Event.KillEnemy, this.onKillEnemy, this);\r\n        window['GameEnemysController'] = this;\r\n    }\r\n\r\n    onDestroy(){\r\n        this.node.off(GameProxy.Event.KillEnemy, this.onKillEnemy, this);\r\n    }\r\n\r\n    private _screenRect:cc.Rect = cc.rect(0, 0, cc.visibleRect.width, cc.visibleRect.height);\r\n    allAliveAndInScreenEnemy():Array<Enemy>{\r\n        let list = [];\r\n        this._screenRect.x = -this.bgNode.x - cc.visibleRect.center.x;\r\n        this._screenRect.y = -this.bgNode.y - cc.visibleRect.center.y;\r\n        for (let node of this.enemyLayer.children){\r\n            let enemy = node.getComponent(Enemy);\r\n            if (!enemy.node.active || enemy.hp <= 0 || enemy.node.x + enemy.spaceCircleCollider.radius <= this._screenRect.xMin || enemy.node.x - enemy.spaceCircleCollider.radius > this._screenRect.xMax || enemy.node.y + enemy.spaceCircleCollider.radius < this._screenRect.yMin || enemy.node.y - enemy.spaceCircleCollider.radius > this._screenRect.yMax){\r\n                continue;\r\n            }\r\n            list.push(enemy);\r\n        }\r\n        return list;\r\n    }\r\n\r\n    allAliveEnemy():Array<Enemy>{\r\n        return this.enemyLayer.children.filter(value => value.active && value.getComponent(Enemy).hp > 0).map(value => value.getComponent(Enemy));\r\n    }\r\n\r\n    allActiveEnemy():Array<Enemy>{\r\n        return this.enemyLayer.children.filter(value => value.active).map(value => value.getComponent(Enemy));\r\n    }\r\n\r\n    createEnemy(id:number){\r\n        // console.log(\"createEnemy==>\", id);\r\n        this.enemyCount++;\r\n        //绑定\r\n        //角色900范围内随机出现\r\n        let x1 = Math.max(-this.bgNode.x - cc.visibleRect.center.x, -this.bgNode.width/2);\r\n        let y1 = Math.max(-this.bgNode.y - cc.visibleRect.center.y, -this.bgNode.height/2);\r\n        let w1 = Math.min(cc.visibleRect.width, this.bgNode.width/2 - x1);\r\n        let h1 = Math.min(cc.visibleRect.height, this.bgNode.height/2 - y1);\r\n        let screenRect = cc.rect(x1, y1, w1, h1);\r\n        let range = 200;\r\n        let x2 = Math.max(x1 - range, -this.bgNode.width/2);\r\n        let y2 = Math.max(y1 - range, -this.bgNode.height/2);\r\n        let w2 = Math.min(cc.visibleRect.width + range*2, this.bgNode.width/2 - x2);\r\n        let h2 = Math.min(cc.visibleRect.height + range*2, this.bgNode.height/2 - y2);\r\n        let rangeRect = cc.rect(x2, y2, w2, h2);\r\n        let partitions = [rangeRect];\r\n        SpacePartition.partitionRect(partitions, screenRect, 30, 30);\r\n        // let partitions = [cc.rect(-this._bgNode.width/2, -this._bgNode.height/2, this._bgNode.width, this._bgNode.height)];\r\n        // this.allActiveEnemy().forEach(value => {\r\n        //     SpacePartition.partitionRect(partitions, value.enemyAABB.aabb());\r\n        // });\r\n        //\r\n        // SpacePartition.partitionRect(partitions, this._gameRoleController.role.roleAABB.aabb());\r\n        let enemy = this.getInactiveEnemy(id);\r\n        let radius = enemy.getComponent(cc.CircleCollider).radius;\r\n        let rect = SpacePartition.randomSpace(partitions, radius*2, radius*2);\r\n\r\n        if (rect){\r\n            enemy.node.position = rect.center;\r\n            enemy.node.active = true;\r\n            this.enemyLogicList.push(enemy);\r\n            window['GameCollisionController'].looseQuadTree.insert(enemy.enemyAABB);\r\n        }else {\r\n            console.error(\"没有空间了...\", partitions);\r\n        }\r\n    }\r\n\r\n    onKillEnemy(enemy:Enemy){\r\n        this.enemyLogicList.splice(this.enemyLogicList.indexOf(enemy), 1);\r\n        window['GameCollisionController'].looseQuadTree.remove(enemy.enemyAABB);\r\n        this.enemyCount--;\r\n    }\r\n\r\n    lateUpdate(){\r\n        if (GameProxy.pauseGame){\r\n            return;\r\n        }\r\n        /** 每次处理固定数量的敌人逻辑 */\r\n        let preNum = 0;\r\n        for (let enemy of this.enemyLogicList){\r\n            if (enemy.logicFlag){\r\n                preNum++;\r\n                enemy.logicFlag = false;\r\n            }else {\r\n                break;\r\n            }\r\n        }\r\n        this.enemyLogicList.push(...this.enemyLogicList.splice(0, preNum));\r\n        let count = Math.min(MAX_LOGIC_COUNT, this.enemyLogicList.length);\r\n        for (let i=0; i<count; i++){\r\n            this.enemyLogicList[i].logicFlag = true;\r\n        }\r\n    }\r\n}\r\n"]}