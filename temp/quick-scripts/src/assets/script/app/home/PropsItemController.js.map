{"version":3,"sources":["assets/script/app/home/PropsItemController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nimport AbstractTableItem from \"../../../framework/tableview/AbstractTableItem\";\r\nimport PropsController from \"./PropsController\";\r\nimport {World} from \"../info/World\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class PropsItemController extends AbstractTableItem {\r\n\r\n    @property(PropsController)\r\n    propsController:PropsController = null;\r\n\r\n    @property(cc.Sprite)\r\n    bgFrameSprite:cc.Sprite = null;\r\n\r\n    @property(cc.Sprite)\r\n    iconSprite:cc.Sprite = null;\r\n\r\n    @property(cc.Label)\r\n    nameLabel:cc.Label = null;\r\n\r\n    @property(cc.Node)\r\n    useNode:cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    usingNode:cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    foreverNode:cc.Node = null;\r\n\r\n    @property(cc.Label)\r\n    cdLabel:cc.Label = null;\r\n\r\n    @property(cc.SpriteFrame)\r\n    iconSpriteFrames:[cc.SpriteFrame] = [];\r\n\r\n    private _data = null;\r\n    private _index = null;\r\n\r\n    onLoad(){\r\n        this.schedule(()=>{\r\n            if (this.node.active && this.usingNode.active && this._data){\r\n                let id = this._data['id'];\r\n                if (World.My.propInfo.beUsing(id)){\r\n                    this.updateCD();\r\n                }else {\r\n                    this.foreverNode.active = false;\r\n                    this.useNode.active = true;\r\n                    this.usingNode.active = false;\r\n                }\r\n            }\r\n        }, 0.99);\r\n\r\n        cc.game.on(\"video_2\",()=>{\r\n            this.onClickUseDo()\r\n        },this);\r\n    }\r\n\r\n    private updateCD(){\r\n        let cd = Math.floor((World.My.propInfo.expireTime(this._data['id']) - new Date().getTime())/1000);\r\n        let min = Math.floor(cd/60);\r\n        let sec = cd%60;\r\n        this.cdLabel.string = `剩余计时 ${(\"000\"+min).substr(-2)+\":\"+(\"000\"+sec).substr(-2)}`;\r\n    }\r\n\r\n    upadteItem(data: any, index: number) {\r\n        this._data = data;\r\n        this._index = index;\r\n        // console.log(data, index);\r\n        let id = data['id'];\r\n        this.iconSprite.spriteFrame = this.iconSpriteFrames[id-1];\r\n        this.nameLabel.string = data['prop_name'];\r\n        if (data['unlock'] == 0){\r\n            this.foreverNode.active = true;\r\n            this.useNode.active = false;\r\n            this.usingNode.active = false;\r\n        }else if (!World.My.propInfo.beUsing(id)) {\r\n            this.foreverNode.active = false;\r\n            this.useNode.active = true;\r\n            this.usingNode.active = false;\r\n        }else {\r\n            this.foreverNode.active = false;\r\n            this.useNode.active = false;\r\n            this.usingNode.active = true;\r\n            this.updateCD();\r\n        }\r\n    }\r\n\r\n    onClickDetail(){\r\n        console.log(\"【click】PropsItemController Detail\")\r\n\r\n        this.propsController.detailLabel.string = this._data['description'];\r\n        this.propsController.detailNode.active = true;\r\n    }\r\n\r\n    onClickUse(){\r\n        console.log(\"【video】2 道具使用 【click】PropsItemController Use\")\r\n\r\n        World.Storage._videoSign=2\r\n        World.Storage.videoAd_show() \r\n    }\r\n\r\n    onClickUseDo(){\r\n        World.My.propInfo.use(this._data['id']);\r\n        this.upadteItem(this._data, this._index);\r\n    }\r\n}\r\n"]}