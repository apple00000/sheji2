{"version":3,"sources":["assets/script/app/home/JackpotController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nimport {World} from \"../info/World\";\r\nimport {ExcelConfig} from \"../../../framework/config/ExcelConfig\";\r\nimport {ExcelTableNames} from \"../config/ExcelTableNames\";\r\nimport {ext} from \"../../../framework/extend/Extend\";\r\nimport {NetworkConfig} from \"../config/NetworkConfig\";\r\nimport Network from \"../network/Network\";\r\nimport Facade from \"../../../framework/facade/Facade\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class JackpotController extends cc.Component {\r\n\r\n    @property(cc.ProgressBar)\r\n    progressBar: cc.ProgressBar = null;\r\n\r\n    @property(cc.Label)\r\n    goldLabel: cc.Label = null;\r\n\r\n    @property(cc.Label)\r\n    takeLabel:cc.Label = null;\r\n\r\n    @property(cc.Button)\r\n    button:cc.Button = null;\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad(){\r\n        this.progressBar.node.active = false;\r\n        this.goldLabel.node.active = false;\r\n        this.takeLabel.node.active = false;\r\n        Facade.canvasNode.on('TakeJackpot', this._takeIt, this);\r\n        this.init();\r\n\r\n        cc.game.on(\"video_6\",()=>{\r\n            this.takeIt3Do()\r\n        },this);\r\n    }\r\n\r\n    onDestroy(){\r\n        Facade.canvasNode.off('TakeJackpot', this._takeIt, this);\r\n    }\r\n\r\n\r\n    init(){\r\n        this.scheduleOnce(()=>{\r\n            this.goldLabel.node.active = true;\r\n            if (World.Storage.dayEarnTotalModifyTime == 0){\r\n                World.Storage.dayEarnTotalModifyTime = World.My.serverTime;\r\n            }\r\n            if (World.Storage.dayEarnExpireTime  == 0){\r\n                World.Storage.dayEarnExpireTime = World.My.serverTime + 24*60*60*1000;\r\n            }\r\n            this.schedule(() => {\r\n                this.updateDayEarnCD();\r\n            }, 0);\r\n            this.updateDayEarnCD();\r\n        }, 0.1);\r\n    }\r\n\r\n    updateDayEarnCD(){\r\n        let currentTime = World.My.serverTime;\r\n        let cdTime = (World.Storage.dayEarnExpireTime - currentTime)/1000;\r\n        let progress = 0;\r\n        if (cdTime > 0){\r\n            progress = (24*60*60*1000 - cdTime*1000)/(24*60*60*1000);\r\n            if (progress > 1){\r\n                progress = 1;\r\n            }\r\n        }else {\r\n            progress = 1;\r\n        }\r\n        this.progressBar.node.active = progress < 1;\r\n        let cfg = ExcelConfig.getExcelTable(ExcelTableNames.GoldUp);\r\n        let dayGet = cfg[World.Storage.dayEarnLv-1]['on_hook'];\r\n        let diffTime = (World.My.serverTime - World.Storage.dayEarnTotalModifyTime)/1000;\r\n        let addTotal = Math.floor(diffTime/3) * dayGet;\r\n        if (addTotal > 0){\r\n            World.Storage.dayEarnTotal += addTotal;\r\n        }\r\n        this.goldLabel.string = ext.shortFormat(World.Storage.dayEarnTotal);\r\n        this.button.interactable = World.Storage.dayEarnTotal > 0;\r\n        this.takeLabel.node.active = World.Storage.dayEarnTotal > 0;\r\n        this.progressBar.progress = (diffTime%3) / 3;\r\n    }\r\n\r\n    _takeIt(num:number){\r\n        console.log(\"【video】6 多倍金币【click】JackpotController _takeIt\", num)\r\n\r\n        if (num==1){\r\n            this.takeId1()\r\n        }else{\r\n            this.takeIt3()\r\n        }\r\n    }\r\n\r\n    takeId1() {\r\n        World.Storage.goldCount += World.Storage.dayEarnTotal*1;\r\n        Facade.executeCommand('ShowTipsCommand', `金币 +${ext.shortFormat(World.Storage.dayEarnTotal*1)}`);\r\n        World.Storage.dayEarnTotal = 0;\r\n        World.Storage.dayEarnExpireTime = World.My.serverTime + 24*60*60*1000;\r\n        this.updateDayEarnCD();\r\n        if (NetworkConfig.connectServer){\r\n            Network.pushStorage();\r\n        }\r\n    }\r\n\r\n    takeIt3() {\r\n        World.Storage._videoSign=6\r\n        World.Storage.videoAd_show() \r\n    }\r\n\r\n    takeIt3Do(){\r\n        World.Storage.goldCount += World.Storage.dayEarnTotal*3;\r\n        Facade.executeCommand('ShowTipsCommand', `金币 +${ext.shortFormat(World.Storage.dayEarnTotal*3)}`);\r\n        World.Storage.dayEarnTotal = 0;\r\n        World.Storage.dayEarnExpireTime = World.My.serverTime + 24*60*60*1000;\r\n        this.updateDayEarnCD();\r\n        if (NetworkConfig.connectServer){\r\n            Network.pushStorage();\r\n        }\r\n    }\r\n}\r\n"]}