{"version":3,"sources":["assets/script/app/home/RoleLayerController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nimport {World} from \"../info/World\";\r\nimport Network from \"../network/Network\";\r\nimport {NetworkConfig} from \"../config/NetworkConfig\";\r\nimport {ExcelConfig} from \"../../../framework/config/ExcelConfig\";\r\nimport {ExcelTableNames} from \"../config/ExcelTableNames\";\r\nimport {ext} from \"../../../framework/extend/Extend\";\r\nimport Facade from \"../../../framework/facade/Facade\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class RoleLayerController extends cc.Component {\r\n\r\n    @property(cc.RichText)\r\n    hpLvLabel: cc.RichText = null;\r\n\r\n    @property(cc.RichText)\r\n    adLvLabel: cc.RichText = null;\r\n\r\n    @property(cc.RichText)\r\n    hpCostLabel: cc.RichText = null;\r\n\r\n    @property(cc.RichText)\r\n    adCostLabel: cc.RichText = null;\r\n\r\n    @property(cc.RichText)\r\n    hpWorthLabel:cc.RichText = null;\r\n\r\n    @property(cc.RichText)\r\n    adWorthLabel:cc.RichText = null;\r\n\r\n    @property(cc.Button)\r\n    hpLvButton:cc.Button = null;\r\n\r\n    @property(cc.Button)\r\n    adButton:cc.Button = null;\r\n\r\n    onLoad () {\r\n        this.updateHpUp();\r\n        this.updateAdUp();\r\n        cc.find('Canvas').on(\"UpdateStorage\", this.onUpdateStorageEvent, this);\r\n    }\r\n\r\n    onDestroy(){\r\n        cc.find('Canvas').off(\"UpdateStorage\", this.onUpdateStorageEvent, this);\r\n    }\r\n\r\n    onUpdateStorageEvent(key:string){\r\n        if (key == \"goldCount\"){\r\n            let config = ExcelConfig.getExcelTable(ExcelTableNames.Weapon)[0];\r\n            if (World.Storage.HpLv < config['lv_limit']){\r\n                let needCost = ExcelConfig.getExcelTable(ExcelTableNames.WeaponUp)[World.Storage.HpLv-1]['life_expend'];\r\n                this.hpLvButton.interactable = World.Storage.goldCount >= needCost;\r\n                this.hpCostLabel.node.color = this.hpLvButton.interactable?cc.Color.WHITE:cc.Color.RED.fromHEX(\"#924338\");\r\n            }\r\n            if (World.Storage.ADLv < config['lv_limit']){\r\n                let needCost = ExcelConfig.getExcelTable(ExcelTableNames.WeaponUp)[World.Storage.ADLv-1]['fight_expend'];\r\n                this.adButton.interactable = World.Storage.goldCount >= needCost;\r\n                this.adCostLabel.node.color = this.adButton.interactable?cc.Color.WHITE:cc.Color.RED.fromHEX(\"#924338\");\r\n            }\r\n        }\r\n    }\r\n\r\n    updateHpUp(){\r\n        let config = ExcelConfig.getExcelTable(ExcelTableNames.Weapon)[0];\r\n        this.hpLvLabel.string = `<b><outline color=#1e1e1e width=4>生命力Lv.${World.Storage.HpLv}</outline></b>`;\r\n        if (World.Storage.HpLv >= config['lv_limit']){\r\n            this.hpCostLabel.string = `<b><outline color=#1e1e1e width=3>满级</outline></b>`;\r\n            this.hpLvButton.interactable = false;\r\n        }else {\r\n            let needCost = ExcelConfig.getExcelTable(ExcelTableNames.WeaponUp)[World.Storage.HpLv-1]['life_expend'];\r\n            this.hpCostLabel.string = `<b><outline color=#1e1e1e width=3>${ext.shortFormat(needCost)}</outline></b>`;\r\n            this.hpLvButton.interactable = World.Storage.goldCount >= needCost;\r\n        }\r\n        this.hpCostLabel.node.color = this.hpLvButton.interactable?cc.Color.WHITE:cc.Color.RED.fromHEX(\"#924338\");\r\n        let life = ExcelConfig.getExcelTable(ExcelTableNames.WeaponUp)[World.Storage.HpLv-1]['life'];\r\n        this.hpWorthLabel.string = `<b><outline color=#1e1e1e width=3>${ext.shortFormat(life)}</outline></b>`;\r\n    }\r\n\r\n    updateAdUp(){\r\n        let config = ExcelConfig.getExcelTable(ExcelTableNames.Weapon)[0];\r\n        this.adLvLabel.string = `<b><outline color=#1e1e1e width=4>战力Lv.${World.Storage.ADLv}</outline></b>`;\r\n        if (World.Storage.ADLv >= config['lv_limit']){\r\n            this.adCostLabel.string = `<b><outline color=#1e1e1e width=3>满级</outline></b>`;\r\n            this.adButton.interactable = false;\r\n        } else {\r\n            let needCost = ExcelConfig.getExcelTable(ExcelTableNames.WeaponUp)[World.Storage.ADLv-1]['fight_expend'];\r\n            this.adCostLabel.string = `<b><outline color=#1e1e1e width=3>${ext.shortFormat(needCost)}</outline></b>`;\r\n            this.adButton.interactable = World.Storage.goldCount >= needCost;\r\n        }\r\n        this.adCostLabel.node.color = this.adButton.interactable?cc.Color.WHITE:cc.Color.RED.fromHEX(\"#924338\");\r\n        let fight = ExcelConfig.getExcelTable(ExcelTableNames.WeaponUp)[World.Storage.ADLv-1]['fight'];\r\n        this.adWorthLabel.string = `<b><outline color=#1e1e1e width=3>${ext.shortFormat(fight)}</outline></b>`;\r\n    }\r\n\r\n    onClickUpHpLv(event, data){\r\n        console.log(\"【click】RoleLayerController UpHpLv\")\r\n\r\n        let needCost = ExcelConfig.getExcelTable(ExcelTableNames.WeaponUp)[World.Storage.HpLv-1]['life_expend'];\r\n        World.Storage.goldCount -= needCost;\r\n        World.Storage.HpLv++;\r\n        this.updateHpUp();\r\n        Facade.canvasNode.emit(\"RoleUp\");\r\n    }\r\n\r\n    private _AdUpCount = 0;\r\n\r\n    onClickUpADLv(event, data){\r\n        console.log(\"【click】RoleLayerController UpADLv\")\r\n\r\n        let needCost = ExcelConfig.getExcelTable(ExcelTableNames.WeaponUp)[World.Storage.ADLv-1]['fight_expend'];\r\n        World.Storage.goldCount -= needCost;\r\n        World.Storage.ADLv++;\r\n        this.updateAdUp();\r\n        Facade.canvasNode.emit(\"RoleUp\");\r\n        this._AdUpCount++;\r\n        let newbieNode = cc.director.getScene().getChildByName(\"newbieNode\");\r\n        if (newbieNode && (!this.adButton.interactable || this._AdUpCount > 2)){\r\n            newbieNode.destroy();\r\n            World.My.newbies.finish(\"FirstRoleUp\");\r\n        }\r\n    }\r\n\r\n}\r\n"]}