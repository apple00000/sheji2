{"version":3,"sources":["assets/framework/extend/ccIntersection.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\n/**\r\n * 求线段相交的交点坐标\r\n * */\r\ncc.Intersection.pLineIntersect = function (a:cc.Vec2,b:cc.Vec2,c:cc.Vec2,d:cc.Vec2, retP:cc.Vec2) {\r\n    if ((a.x === b.x && a.y === b.y) || (c.x === d.x && c.y === d.y)) {\r\n        return false;\r\n    }\r\n    // 三角形abc 面积的2倍\r\n    var area_abc = (a.x - c.x) * (b.y - c.y) - (a.y - c.y) * (b.x - c.x);\r\n\r\n    // 三角形abd 面积的2倍\r\n    var area_abd = (a.x - d.x) * (b.y - d.y) - (a.y - d.y) * (b.x - d.x);\r\n\r\n    // 面积符号相同则两点在线段同侧,不相交 (对点在线段上的情况,本例当作不相交处理);\r\n    if ( area_abc*area_abd>=0 ) {\r\n        return false;\r\n    }\r\n\r\n    // 三角形cda 面积的2倍\r\n    var area_cda = (c.x - a.x) * (d.y - a.y) - (c.y - a.y) * (d.x - a.x);\r\n    // 三角形cdb 面积的2倍\r\n    // 注意: 这里有一个小优化.不需要再用公式计算面积,而是通过已知的三个面积加减得出.\r\n    var area_cdb = area_cda + area_abc - area_abd ;\r\n    if (  area_cda * area_cdb >= 0 ) {\r\n        return false;\r\n    }\r\n\r\n    //计算交点坐标\r\n    var t = area_cda / ( area_abd- area_abc );\r\n    var dx= t*(b.x - a.x),\r\n        dy= t*(b.y - a.y);\r\n    retP.x = a.x + dx;\r\n    retP.y = a.y + dy;\r\n    return true;\r\n};\r\n\r\n/**\r\n * 求线段与圆之间的交点坐标\r\n * */\r\ncc.Intersection.pLineCircle = function (point1:cc.Vec2, point2:cc.Vec2, circle:{position: cc.Vec2, radius: number}, out:Array<cc.Vec2>):boolean {\r\n    let t;\r\n\r\n    let dx = point2.x - point1.x;\r\n    let dy = point2.y - point1.y;\r\n\r\n    let a = dx * dx + dy * dy;\r\n    let b = 2 * (dx * (point1.x - circle.position.x) + dy * (point1.y - circle.position.y));\r\n    let c = (point1.x - circle.position.x) * (point1.x - circle.position.x) + (point1.y - circle.position.y) * (point1.y - circle.position.y) - circle.radius * circle.radius;\r\n\r\n    let determinate = b * b - 4 * a * c;\r\n    if ((a <= 0.0000001) || (determinate < -0.0000001))\r\n    {\r\n        // No real solutions.\r\n        return false;\r\n    }\r\n    if (determinate < 0.0000001 && determinate > -0.0000001)\r\n    {\r\n        // One solution.\r\n        t = -b / (2 * a);\r\n        out.push(cc.v2(point1.x + t * dx, point1.y + t * dy));\r\n        return true;\r\n    }\r\n\r\n    // Two solutions.\r\n    t = ((-b + Math.sqrt(determinate)) / (2 * a));\r\n    out.push(cc.v2(point1.x + t * dx, point1.y + t * dy));\r\n    t = ((-b - Math.sqrt(determinate)) / (2 * a));\r\n    out.push(cc.v2(point1.x + t * dx, point1.y + t * dy));\r\n\r\n    return true;\r\n}\r\n"]}