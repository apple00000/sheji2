{"version":3,"sources":["assets/script/app/entities/bulletEmitter/BulletEmitterJiGuang.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nimport GameBulletsController from \"../../game/GameBulletsController\";\r\nimport BulletEmitter from \"./BulletEmitter\";\r\nimport Bullet from \"../bullet/Bullet\";\r\nimport Role from \"../role/Role\";\r\n\r\n\r\nexport default class BulletEmitterJiGuang extends BulletEmitter {\r\n\r\n    constructor(gameBulletsController:GameBulletsController){\r\n        super(gameBulletsController);\r\n        this._firingRange = 800;\r\n        this._interval = 0.05;\r\n        this._speed = 1500;\r\n    }\r\n\r\n    private _bulletJiGuang:Bullet = null;\r\n    private _bulletJiGuangSke:sp.Skeleton = null;\r\n\r\n    private _role:Role = null;\r\n\r\n    onEnter(){\r\n        let bullet = this.gameBulletsController.getInactiveBullet(BulletEmitter.TYPES.JiGuang);\r\n        bullet.collider.enabled = false;\r\n        let ske = bullet.getComponent(sp.Skeleton);\r\n        ske.setStartListener((trackEntry, loopCount)=>{\r\n            let name = trackEntry.animation ? trackEntry.animation.name : '';\r\n            if(name === \"jiguang\"){\r\n                bullet.collider.enabled = true;\r\n            }\r\n        });\r\n        ske.setCompleteListener((trackEntry, loopCount) => {\r\n            let name = trackEntry.animation ? trackEntry.animation.name : '';\r\n            if (name === \"xuneng\") {\r\n                ske.setAnimation(0, \"jiguang\", false);\r\n            }else if(name === \"jiguang\"){\r\n                this.bulletCount--;\r\n                bullet.collider.enabled = false;\r\n                bullet.node.runAction(cc.sequence(cc.delayTime(0), cc.callFunc(()=>{\r\n                    if (!bullet.collider.enabled){\r\n                        bullet.node.active = false;\r\n                    }\r\n                })));\r\n            }\r\n        });\r\n        this._bulletJiGuangSke = ske;\r\n        this._bulletJiGuang = bullet;\r\n\r\n        this._role = window['GameRoleController'].role;\r\n        this.changeBulletPosition();\r\n        this._role.node.on(cc.Node.EventType.POSITION_CHANGED, this.changeBulletPosition, this);\r\n        this._role.node.on(cc.Node.EventType.ROTATION_CHANGED, this.changeBulletPosition, this);\r\n    }\r\n    onExit(){\r\n        this._bulletJiGuang.node.active = false;\r\n        this._role.node.off(cc.Node.EventType.POSITION_CHANGED, this.changeBulletPosition, this);\r\n        this._role.node.off(cc.Node.EventType.ROTATION_CHANGED, this.changeBulletPosition, this);\r\n    }\r\n\r\n    changeBulletPosition(){\r\n        this._bulletJiGuang.node.rotation = this._role.node.rotation;\r\n        this._bulletJiGuang.node.position = this._role.node.position.add(cc.v2(0, 1).rotate(cc.misc.degreesToRadians(-this._role.node.rotation)).normalize().mul(this._role.gunTopNode.y + 20));\r\n    }\r\n\r\n    fire(start: cc.Vec2, dir: cc.Vec2) {\r\n        if (!this._bulletJiGuang.node.active){\r\n            this._bulletJiGuang.node.active = true;\r\n            this._bulletJiGuangSke.setAnimation(0, \"xuneng\", false);\r\n        }else if (this._bulletJiGuangSke.animation === \"jiguang\" && !this._bulletJiGuang.collider.enabled){\r\n            this._bulletJiGuangSke.setAnimation(0, \"jiguang\", false);\r\n        }\r\n    }\r\n}\r\n"]}