{"version":3,"sources":["assets/script/app/home/RecommendPropsController.ts"],"names":[],"mappings":";;;;;AACA,8CAAyC;AACzC,uCAAoC;AACpC,2DAAqD;AACrD,8EAAyE;AACnE,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAE1C,WAAW;AACX,IAAM,aAAa,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;AAGhC;IAAsD,4CAAY;IAAlE;QAAA,qEA0JC;QAvJG,UAAI,GAAQ,IAAI,CAAC;QAGjB,kBAAY,GAAe,IAAI,CAAC;QAGhC,aAAO,GAAW,IAAI,CAAC;QAGvB,eAAS,GAAW,IAAI,CAAC;QAEzB;;aAEK;QACG,aAAO,GAAG,CAAC,CAAC;;IAyIxB,CAAC;IAvIG,yCAAM,GAAN;QAAA,iBAyBC;QAxBG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACtC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,gBAAgB,EAAE;YAClD,KAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,KAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;QACtE,CAAC,CAAC,CAAC;QACH,IAAI,qBAAqB,GAAG,MAAM,CAAC,uBAAuB,CAAC,CAAC;QAC5D,qBAAqB,CAAC,WAAW,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,UAAC,UAAkB;YACnF,UAAU,CAAC,KAAK,GAAG,IAAI,CAAC;QAC5B,CAAC,CAAC,CAAC;QACH,IAAI,IAAI,GAAG,aAAa,CAAC,MAAM,CAAC,UAAA,KAAK,IAAI,OAAA,CAAC,aAAK,CAAC,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,EAAjC,CAAiC,CAAC,CAAC;QAC5E,IAAI,IAAI,CAAC,MAAM,IAAI,CAAC,EAAC;YACjB,IAAI,GAAG,aAAa,CAAC;SACxB;QACD,IAAI,CAAC,OAAO,GAAG,YAAG,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QACvC,IAAI,UAAU,GAAG,mCAAmC,GAAC,IAAI,CAAC,OAAO,CAAC;QAElE,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,MAAM,EAAE,UAAC,KAAK,EAAE,QAAQ;YACrD,IAAI,KAAK,IAAI,IAAI,EAAC;gBACd,KAAI,CAAC,WAAW,EAAE,CAAC;aACtB;QACL,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,SAAS,EAAC;YACjB,KAAI,CAAC,YAAY,EAAE,CAAA;QACvB,CAAC,EAAC,IAAI,CAAC,CAAC;IACZ,CAAC;IAED,8CAAW,GAAX;QAAA,iBAyFC;QAxFG,OAAO,CAAC,GAAG,CAAC,iBAAiB,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;QAC7C,QAAQ,IAAI,CAAC,OAAO,EAAC;YACjB,KAAK,CAAC;gBACN;oBACI,+BAA+B;oBAC/B,IAAI,GAAG,GAAG,CAAC,CAAC;oBACZ,IAAI,YAAU,GAAG,GAAG,GAAC,CAAC,CAAC;oBACvB,IAAI,QAAQ,GAAG,IAAI,CAAC;oBACpB,IAAI,SAAO,GAAG,EAAE,CAAC;oBACjB,IAAI,SAAS,GAAG,IAAI,CAAC;oBACrB,IAAI,cAAY,GAAG,SAAO,GAAC,SAAS,CAAC;oBACrC,IAAI,MAAI,GAAG,EAAE,CAAC;oBACd,IAAI,UAAQ,GAAG,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;4CAChD,CAAC;wBACN,OAAK,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,GAAC,QAAQ,CAAC,EAAE,EAAE,CAAC,QAAQ,CAAC;4BAClE,IAAI,MAAM,GAAG,MAAM,CAAC,uBAAuB,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;4BACtE,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;4BAC1B,IAAI,MAAM,GAAG,EAAE,GAAE,CAAC,GAAG,YAAU,CAAC;4BAChC,MAAM,CAAC,IAAI,CAAC,QAAQ,GAAG,MAAM,GAAG,EAAE,CAAC;4BACnC,IAAI,GAAG,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,aAAa,EAAE,CAAC;4BACpF,MAAM,CAAC,IAAI,CAAC,QAAQ,GAAG,UAAQ,CAAC;4BAChC,MAAM,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;4BACtB,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,OAAO,CAAC,cAAY,EAAE,CAAC,CAAC,CAAC,CAAC;4BACnD,MAAM,CAAC,QAAQ,CAAC,OAAO,GAAG,KAAK,CAAC;4BAChC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC,cAAY,EAAE,GAAG,CAAC,GAAG,CAAC,SAAO,CAAC,CAAC,EAAE,EAAE,CAAC,QAAQ,CAAC;gCACrF,MAAM,CAAC,QAAQ,CAAC,OAAO,GAAG,IAAI,CAAC;gCAC/B,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,SAAS,CAAC,MAAI,CAAC,EAAE,EAAE,CAAC,QAAQ,CAAC;oCAC9D,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;gCAC/B,CAAC,CAAC,CAAC,CAAC,CAAC;4BACT,CAAC,CAAC,CAAC,CAAC,CAAC;wBACT,CAAC,CAAC,CAAC,CAAC,CAAC;;;oBAjBT,KAAK,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,GAAG,EAAE,CAAC,EAAE;gCAAf,CAAC;qBAkBT;4CAEQ,CAAC;wBACN,OAAK,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC,GAAC,GAAG,CAAC,GAAC,QAAQ,CAAC,EAAE,EAAE,CAAC,QAAQ,CAAC;4BACxE,IAAI,MAAM,GAAG,MAAM,CAAC,uBAAuB,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;4BACtE,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;4BAC1B,IAAI,MAAM,GAAG,EAAE,GAAG,CAAC,GAAG,YAAU,CAAC;4BACjC,MAAM,CAAC,IAAI,CAAC,QAAQ,GAAG,MAAM,GAAG,EAAE,CAAC;4BACnC,IAAI,GAAG,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,aAAa,EAAE,CAAC;4BACpF,MAAM,CAAC,IAAI,CAAC,QAAQ,GAAG,UAAQ,CAAC;4BAChC,MAAM,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;4BACtB,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,OAAO,CAAC,cAAY,EAAE,CAAC,CAAC,CAAC,CAAC;4BACnD,MAAM,CAAC,QAAQ,CAAC,OAAO,GAAG,KAAK,CAAC;4BAChC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC,cAAY,EAAE,GAAG,CAAC,GAAG,CAAC,SAAO,GAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,QAAQ,CAAC;gCACxF,MAAM,CAAC,QAAQ,CAAC,OAAO,GAAG,IAAI,CAAC;gCAC/B,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,SAAS,CAAC,MAAI,CAAC,EAAE,EAAE,CAAC,QAAQ,CAAC;oCAC9D,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;gCAC/B,CAAC,CAAC,CAAC,CAAC,CAAC;4BACT,CAAC,CAAC,CAAC,CAAC,CAAC;wBACT,CAAC,CAAC,CAAC,CAAC,CAAC;;;oBAjBT,KAAK,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,GAAG,EAAE,CAAC,EAAE;gCAAf,CAAC;qBAkBT;oBACD,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,SAAS,CAAC,MAAI,GAAC,CAAC,CAAC,EAAE,EAAE,CAAC,QAAQ,CAAC;wBAC9D,KAAI,CAAC,WAAW,EAAE,CAAC;oBACvB,CAAC,CAAC,CAAC,CAAC,CAAC;iBACR;gBACG,MAAM;YACV,KAAK,CAAC;gBACN;oBACI,eAAe;oBACf,IAAI,MAAM,GAAwB,MAAM,CAAC,uBAAuB,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;oBAC3F,MAAM,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;oBAC/C,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;oBAC1B,MAAM,CAAC,YAAY,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC,YAAY,CAAC,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;oBAC9D,MAAM,CAAC,YAAY,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC,mBAAmB,CAAC,cAAK,CAAC,CAAC,CAAC;oBAC7D,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,6BAAmB,CAAC,CAAC;iBACpD;gBACG,MAAM;YACV,KAAK,CAAC;gBACF,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;gBACrC,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC;gBAClD,IAAI,CAAC,YAAY,CAAC,mBAAmB,CAAC,UAAC,UAAU,EAAE,SAAS;oBACxD,IAAI,IAAI,GAAG,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;oBACjE,oDAAoD;oBACpD,IAAI,IAAI,IAAI,OAAO,IAAI,IAAI,IAAI,YAAY,EAAC;wBACxC,KAAI,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC;wBAClD,IAAI,CAAC,KAAI,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,EAAC;4BAC/B,IAAI,WAAW,GAAG,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,aAAa,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;4BACxE,WAAW,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;4BACxB,KAAI,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;4BAC9C,EAAE,CAAC,KAAK,CAAC,WAAW,CAAC;iCAChB,EAAE,CAAC,CAAC,EAAE,EAAC,MAAM,EAAC,CAAC,EAAC,EAAE,EAAE,MAAM,EAAE,QAAQ,EAAC,CAAC;iCACtC,KAAK,EAAE,CAAC;yBAChB;qBACJ;gBACL,CAAC,CAAC,CAAC;gBACH,MAAM;SACb;IACL,CAAC;IAED,6CAAU,GAAV,UAAW,KAAK,EAAE,IAAI;QAClB,OAAO,CAAC,GAAG,CAAC,kDAAkD,CAAC,CAAA;QAE/D,aAAK,CAAC,OAAO,CAAC,UAAU,GAAC,CAAC,CAAA;QAC1B,aAAK,CAAC,OAAO,CAAC,YAAY,EAAE,CAAA;IAChC,CAAC;IAED,+CAAY,GAAZ;QACI,aAAK,CAAC,EAAE,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACpC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;IACxB,CAAC;IAED,+CAAY,GAAZ,UAAa,KAAK,EAAE,IAAI;QACpB,OAAO,CAAC,GAAG,CAAC,uCAAuC,CAAC,CAAA;QAEpD,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;IACxB,CAAC;IAtJD;QADC,QAAQ,CAAC,cAAI,CAAC;0DACE;IAGjB;QADC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC;kEACU;IAGhC;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;6DACK;IAGvB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;+DACO;IAZR,wBAAwB;QAD5C,OAAO;OACa,wBAAwB,CA0J5C;IAAD,+BAAC;CA1JD,AA0JC,CA1JqD,EAAE,CAAC,SAAS,GA0JjE;kBA1JoB,wBAAwB","file":"","sourceRoot":"/","sourcesContent":["\r\nimport Role from \"../entities/role/Role\";\r\nimport {World} from \"../info/World\";\r\nimport {ext} from \"../../../framework/extend/Extend\";\r\nimport BulletOfJianGuangSi from \"../entities/bullet/BulletOfJianGuangSi\";\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n/** 侯选列表 */\r\nconst candidateList = [3, 4, 5];\r\n\r\n@ccclass\r\nexport default class RecommendPropsController extends cc.Component {\r\n\r\n    @property(Role)\r\n    role:Role = null;\r\n\r\n    @property(sp.Skeleton)\r\n    fangHuDunSke:sp.Skeleton = null;\r\n\r\n    @property(cc.Node)\r\n    useNode:cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    noUseNode:cc.Node = null;\r\n\r\n    /**\r\n     * 道具id\r\n     * */\r\n    private _propId = 0;\r\n\r\n    onLoad () {\r\n        this.fangHuDunSke.node.active = false;\r\n        this.noUseNode.on(cc.Node.EventType.POSITION_CHANGED, ()=>{\r\n            this.useNode.position = this.noUseNode.position.add(cc.v2(0, 87));\r\n        });\r\n        let gameBulletsController = window['GameBulletsController'];\r\n        gameBulletsController.bulletLayer.on(cc.Node.EventType.CHILD_ADDED, (bulletNode:cc.Node)=>{\r\n            bulletNode.group = \"ui\";\r\n        });\r\n        let list = candidateList.filter(value => !World.My.propInfo.beUsing(value));\r\n        if (list.length == 0){\r\n            list = candidateList;\r\n        }\r\n        this._propId = ext.randomElement(list);\r\n        let prefabPath = 'prefab/entities/bullet/propBullet'+this._propId;\r\n\r\n        cc.loader.loadRes(prefabPath, cc.Prefab, (error, resource) => {\r\n            if (error == null){\r\n                this.updateShown();\r\n            }\r\n        });\r\n\r\n        cc.game.on(\"video_1\",()=>{\r\n            this.onClickUseDo()\r\n        },this);\r\n    }\r\n\r\n    updateShown(){\r\n        console.log(\"updateShown===>\", this._propId);\r\n        switch (this._propId){\r\n            case 3:\r\n            {\r\n                /** 发出12个地雷 怪物踩到就会爆炸 地雷持续20S */\r\n                let num = 6;\r\n                let onceDegree = 360/6;\r\n                let onceTime = 0.05;\r\n                let moveLen = 80;\r\n                let moveSpeed = 1000;\r\n                let moveDuration = moveLen/moveSpeed;\r\n                let time = 20;\r\n                let startPos = cc.v2(this.role.node.x, this.role.node.y);\r\n                for (let i=0; i<num; i++){\r\n                    this.node.runAction(cc.sequence(cc.delayTime(i*onceTime), cc.callFunc(()=>{\r\n                        let bullet = window['GameBulletsController'].getInactivePropBullet(3);\r\n                        bullet.node.active = true;\r\n                        let degree = 30+ i * onceDegree;\r\n                        bullet.node.rotation = degree - 90;\r\n                        let dir = cc.v2(0, 1).rotateSelf(cc.misc.degreesToRadians(-degree)).normalizeSelf();\r\n                        bullet.node.position = startPos;\r\n                        bullet.node.scale = 0;\r\n                        bullet.node.runAction(cc.scaleTo(moveDuration, 1));\r\n                        bullet.collider.enabled = false;\r\n                        bullet.node.runAction(cc.sequence(cc.moveBy(moveDuration, dir.mul(moveLen)), cc.callFunc(()=>{\r\n                            bullet.collider.enabled = true;\r\n                            bullet.node.runAction(cc.sequence(cc.delayTime(time), cc.callFunc(()=>{\r\n                                bullet.node.active = false;\r\n                            })));\r\n                        })));\r\n                    })));\r\n                }\r\n\r\n                for (let i=0; i<num; i++){\r\n                    this.node.runAction(cc.sequence(cc.delayTime((i+num)*onceTime), cc.callFunc(()=>{\r\n                        let bullet = window['GameBulletsController'].getInactivePropBullet(3);\r\n                        bullet.node.active = true;\r\n                        let degree = 60 + i * onceDegree;\r\n                        bullet.node.rotation = degree - 90;\r\n                        let dir = cc.v2(0, 1).rotateSelf(cc.misc.degreesToRadians(-degree)).normalizeSelf();\r\n                        bullet.node.position = startPos;\r\n                        bullet.node.scale = 0;\r\n                        bullet.node.runAction(cc.scaleTo(moveDuration, 1));\r\n                        bullet.collider.enabled = false;\r\n                        bullet.node.runAction(cc.sequence(cc.moveBy(moveDuration, dir.mul(moveLen+60)), cc.callFunc(()=>{\r\n                            bullet.collider.enabled = true;\r\n                            bullet.node.runAction(cc.sequence(cc.delayTime(time), cc.callFunc(()=>{\r\n                                bullet.node.active = false;\r\n                            })));\r\n                        })));\r\n                    })));\r\n                }\r\n                this.node.runAction(cc.sequence(cc.delayTime(time+1), cc.callFunc(()=>{\r\n                    this.updateShown();\r\n                })));\r\n            }\r\n                break;\r\n            case 4:\r\n            {\r\n                /** 播放见光死的动画 */\r\n                let bullet = <BulletOfJianGuangSi>window['GameBulletsController'].getInactivePropBullet(4);\r\n                bullet.node.position = this.role.node.position;\r\n                bullet.node.active = true;\r\n                bullet.getComponent(sp.Skeleton).setAnimation(0, \"614\", true);\r\n                bullet.getComponent(sp.Skeleton).setCompleteListener(()=>{});\r\n                bullet.node.removeComponent(BulletOfJianGuangSi);\r\n            }\r\n                break;\r\n            case 5:\r\n                this.fangHuDunSke.node.active = true;\r\n                this.fangHuDunSke.setAnimation(0, \"start\", false);\r\n                this.fangHuDunSke.setCompleteListener((trackEntry, loopCount) => {\r\n                    let name = trackEntry.animation ? trackEntry.animation.name : '';\r\n                    // console.log(\"=============>completeLis..\", name);\r\n                    if (name == \"start\" || name == \"transition\"){\r\n                        this.fangHuDunSke.setAnimation(0, \"loops\", false);\r\n                        if (!this.node.getActionByTag(114)){\r\n                            let speedAction = cc.speed(cc.repeatForever(cc.rotateBy(1.25, 720)), 0);\r\n                            speedAction.setTag(114);\r\n                            this.fangHuDunSke.node.runAction(speedAction);\r\n                            cc.tween(speedAction)\r\n                                .to(1, {_speed:1}, { easing: 'sineIn'})\r\n                                .start();\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n        }\r\n    }\r\n\r\n    onClickUse(event, data){\r\n        console.log(\"【video】1 道具推荐【click】RecommendPropsController Use\")\r\n\r\n        World.Storage._videoSign=1\r\n        World.Storage.videoAd_show() \r\n    }\r\n\r\n    onClickUseDo() {\r\n        World.My.propInfo.use(this._propId);\r\n        this.node.destroy();\r\n    }\r\n\r\n    onClickNoUse(event, data){\r\n        console.log(\"【click】RecommendPropsController NoUse\")\r\n\r\n        this.node.destroy();\r\n    }\r\n}\r\n"]}