{"version":3,"sources":["assets/script/app/game/GameProxy.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import {ExcelTableNames, LevelConfig} from \"../config/ExcelTableNames\";\r\nimport {ExcelConfig} from \"../../../framework/config/ExcelConfig\";\r\nimport {ext} from \"../../../framework/extend/Extend\";\r\nimport {World} from \"../info/World\";\r\n\r\nlet ENEMY_HURT_MUL = 1;\r\nlet ENEMY_HP_MUL = 1;\r\nlet ENEMY_GOLD_MUL = 1;\r\nlet PASS_GOLD_MUL = 1;\r\n\r\n\r\nexport class GameProxy {\r\n    static GameScene:cc.Node = null;\r\n    static Event = {\r\n        StartGenEnemy:\"StartGenEnemy\",\r\n        StopGenEnemy:\"StopGenEnemy\",\r\n        KillEnemy:\"KillEnemy\",\r\n        KillRole:\"KillRole\",\r\n        PauseGame:\"PauseGame\",\r\n        SlowGame:\"SlowGame\",\r\n        InitGame:\"InitGame\",\r\n        StartGame:\"StartGame\",\r\n        ReliveGame:\"ReliveGame\",\r\n        OverGame:\"OverGame\",\r\n        UpdateBulletCount:\"UpdateBulletCount\",\r\n        ShakeScreen:\"ShakeScreen\",\r\n        PropCDZero:\"PropCDZero\",\r\n        PropTrigger:\"PropTrigger\",\r\n    };\r\n\r\n    static emit(e:string, ...args){\r\n        if (this.GameScene){\r\n            this.GameScene.emit(e, ...args);\r\n        }\r\n    }\r\n\r\n    static firstAidFlag = true;\r\n\r\n    static secondBossNum = 0;\r\n\r\n    /** 关卡 */\r\n    private static _level = 0;\r\n\r\n    static get level(): number {\r\n        return this._level;\r\n    }\r\n\r\n    static set level(value: number) {\r\n        this._level = value;\r\n        console.log(\"_level===>\", this._level);\r\n        let goldUpCfg = ExcelConfig.getExcelTable(ExcelTableNames.GoldUp);\r\n        let enemyUpCfg = ExcelConfig.getExcelTable(ExcelTableNames.EnemyUp);\r\n        ENEMY_HURT_MUL = enemyUpCfg[this._level]['enemy_hurt'];\r\n        ENEMY_HP_MUL = enemyUpCfg[this._level]['enemy_health'];\r\n        ENEMY_GOLD_MUL = enemyUpCfg[this._level]['enemy_gold'] * goldUpCfg[World.Storage.goldLv-1]['gvalue'];\r\n        PASS_GOLD_MUL = enemyUpCfg[this._level]['clear_gold'];\r\n        let levelConfig = ExcelConfig.getExcelTable(ExcelTableNames.Level);\r\n        if (this._level <= levelConfig.length - 4){\r\n            this._levelConfig = levelConfig[this._level-1];\r\n        }else {\r\n            /** 最后四关里随机一关 */\r\n            this._levelConfig = levelConfig[levelConfig.length - 4 + Math.ceil(Math.random()*100)%4];\r\n        }\r\n        if (!this._levelConfig){\r\n            console.error(\"levelConfig error==>\"+this._level);\r\n        }\r\n        /** 生成敌人列表 */\r\n        let enemyArr1 = [], enemyArr2 = [];\r\n        let maxEnemyId1 = 0, maxEnemyId2 = 0;\r\n        let max1 = 0, max2 = 0;\r\n        let enemyID = 1;\r\n        while (typeof this._levelConfig[`p1_enemy_${enemyID}`] !== \"undefined\"){\r\n            if (this._levelConfig[`p1_enemy_${enemyID}`] > 0){\r\n                for (let i=0; i<Math.floor(this._levelConfig[`p1_enemy_${enemyID}`] * this._levelConfig.amount_p1); i++){\r\n                    enemyArr1.push(enemyID);\r\n                }\r\n                if (this._levelConfig[`p1_enemy_${enemyID}`] > max1){\r\n                    max1 = this._levelConfig[`p1_enemy_${enemyID}`];\r\n                    maxEnemyId1 = enemyID;\r\n                }\r\n            }\r\n\r\n            if (this._levelConfig[`p2_enemy_${enemyID}`] > 0){\r\n                for (let i=0; i<Math.floor(this._levelConfig[`p2_enemy_${enemyID}`] * this._levelConfig.amount_p2); i++){\r\n                    enemyArr2.push(enemyID);\r\n                }\r\n                if (this._levelConfig[`p2_enemy_${enemyID}`] > max2){\r\n                    max2 = this._levelConfig[`p2_enemy_${enemyID}`];\r\n                    maxEnemyId2 = enemyID;\r\n                }\r\n            }\r\n            enemyID++;\r\n        }\r\n\r\n        this._levelConfig.amount_p1 = enemyArr1.length;\r\n        this._levelConfig.amount_p2 = enemyArr2.length;\r\n\r\n        /** 打乱顺序 */\r\n        ext.shuffle(enemyArr1);\r\n        ext.shuffle(enemyArr2);\r\n\r\n        /** 得到敌人列表 */\r\n        this._enemyList.length = 0;\r\n        this._enemyList.push(...enemyArr1);\r\n        for (let i=0; i<this._levelConfig.p1_boss_7; i++){\r\n            this._enemyList.push(7);\r\n        }\r\n        for (let i=0; i<this._levelConfig.p1_boss_8; i++){\r\n            this._enemyList.push(8);\r\n        }\r\n\r\n        this._enemyList.push(...enemyArr2);\r\n        for (let i=0; i<this._levelConfig.p2_boss_7; i++){\r\n            this._enemyList.push(7);\r\n        }\r\n        for (let i=0; i<this._levelConfig.p2_boss_8; i++){\r\n            this._enemyList.push(8);\r\n        }\r\n\r\n        //初始化属性\r\n        this.isOver = false;\r\n        this.killCount = 0;\r\n        this.goldCount = 0;\r\n        this.secondBossNum = this._levelConfig.p2_boss_7 + this._levelConfig.p2_boss_8;\r\n        this._maxEnemyNum = this._enemyList.length;\r\n        this._slowGame = false;\r\n        this._pauseGame = false;\r\n        this.magnetic = false;\r\n    }\r\n\r\n    /** 关卡配置 */\r\n    private static _levelConfig:LevelConfig = null;\r\n\r\n\r\n    static get levelConfig(): LevelConfig {\r\n        return this._levelConfig;\r\n    }\r\n\r\n    /** 敌人列表 */\r\n    private static _enemyList:Array<number> = [];\r\n\r\n\r\n    static get enemyList(): Array<number> {\r\n        return this._enemyList;\r\n    }\r\n\r\n    /** 预选枪支 */\r\n    static prepareGun = 0;\r\n\r\n    /** 是否结束 */\r\n    static isOver = false;\r\n\r\n    /** 杀敌数 */\r\n    static killCount = 0;\r\n\r\n    /** 金币数 */\r\n    static goldCount = 0;\r\n\r\n    /** 金币番倍 */\r\n    static goldMul = 1;\r\n\r\n    /** 暂停 */\r\n    private static _pauseGame = false;\r\n\r\n    /** 磁力道具 */\r\n    static magnetic = false;\r\n\r\n\r\n    static get pauseGame(): boolean {\r\n        return this._pauseGame;\r\n    }\r\n\r\n    static set pauseGame(value: boolean) {\r\n        console.log(\"GameProxy===>pauseGame\", value);\r\n        if (this._pauseGame != value){\r\n            this._pauseGame = value;\r\n            this.emit(this.Event.PauseGame, this._pauseGame);\r\n        }\r\n    }\r\n\r\n    /** 变慢 */\r\n    private static _slowGame = false;\r\n\r\n    static get slowGame(): boolean {\r\n        return this._slowGame;\r\n    }\r\n\r\n    static set slowGame(value: boolean) {\r\n        if (this._slowGame != value){\r\n            this._slowGame = value;\r\n            this.emit(this.Event.SlowGame, this._slowGame);\r\n        }\r\n    }\r\n\r\n    /** 敌人总数 */\r\n    private static _maxEnemyNum = 0;\r\n\r\n    static get maxEnemyNum(): number {\r\n        return this._maxEnemyNum;\r\n    }\r\n\r\n    /** 敌人伤害公式 */\r\n    static enemyHurtMulOf(enemyId:number){\r\n        return ENEMY_HURT_MUL;\r\n    }\r\n\r\n    /** 敌人血量公式 */\r\n    static enemyHpMulOf(enemyId:number){\r\n        return ENEMY_HP_MUL;\r\n    }\r\n\r\n    /** 敌人金币产量公式 */\r\n    static enemyGoldMulOf(enemyId:number){\r\n        return ENEMY_GOLD_MUL;\r\n    }\r\n\r\n    /** 过关金币公式 */\r\n    static passGold(){\r\n        return PASS_GOLD_MUL;\r\n    }\r\n}\r\n"]}